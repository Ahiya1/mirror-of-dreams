<!-- FILE: public/reflection.html  ‚Ä¢  fully updated for authentic Hebrew & unified flow ‚Ä¢  2025-06-01 -->
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Reflection | ◊û◊®◊ê◊™ ◊î◊ê◊û◊™</title>

    <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  INLINE STYLES  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 25%,
          #16213e 50%,
          #0f0f23 100%
        );
        min-height: 100vh;
        color: #fff;
        overflow-x: hidden;
      }
      [dir="rtl"] {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }
      .container {
        max-width: 700px;
        margin: 0 auto;
        padding: 2rem;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .experience-section {
        width: 100%;
        text-align: center;
        opacity: 0;
        transform: translateY(30px);
        transition: 0.8s;
      }
      .experience-section.active {
        opacity: 1;
        transform: translateY(0);
      }
      .experience-section.hidden {
        display: none;
      }

      /* philosophy */
      .philosophy-text {
        font-size: 1.1rem;
        font-weight: 300;
        opacity: 0.9;
        line-height: 1.6;
        font-style: italic;
        margin-bottom: 3rem;
      }
      .continue-btn {
        width: 100%;
        padding: 1.2rem 2rem;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 3rem;
      }
      .continue-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
      }
      .continue-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* verification */
      .code-input-container {
        max-width: 300px;
        margin: 2rem auto;
      }
      .code-input {
        width: 100%;
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: #fff;
        font-size: 1.5rem;
        text-align: center;
        letter-spacing: 0.3em;
        font-family: "Courier New", monospace;
        font-weight: 600;
        transition: 0.3s;
      }
      .code-input:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.12);
      }
      .code-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
        letter-spacing: 0.2em;
      }

      .error-message {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.4);
        color: #fecaca;
        padding: 1rem;
        border-radius: 12px;
        margin-top: 1rem;
        text-align: center;
        font-size: 0.9rem;
      }

      /* questions */
      .questions-form {
        text-align: left;
      }
      [dir="rtl"] .questions-form {
        text-align: right;
      }
      .question-group {
        margin-bottom: 3rem;
        opacity: 0;
        transform: translateY(20px);
        transition: 0.6s;
      }
      .question-group.visible {
        opacity: 1;
        transform: translateY(0);
      }
      .question-number {
        font-size: 0.9rem;
        opacity: 0.6;
        margin-bottom: 0.5rem;
      }
      .question-text {
        font-size: 1.2rem;
        font-weight: 400;
        margin-bottom: 1rem;
        line-height: 1.4;
      }
      .question-subtitle {
        font-size: 0.9rem;
        opacity: 0.7;
        margin-bottom: 1rem;
        font-style: italic;
      }
      .question-input,
      .question-textarea {
        width: 100%;
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: #fff;
        font-size: 1rem;
        line-height: 1.5;
        transition: 0.3s;
        font-family: inherit;
      }
      .question-textarea {
        min-height: 120px;
        resize: vertical;
      }
      .question-input:focus,
      .question-textarea:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.12);
      }
      .question-input::placeholder,
      .question-textarea::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }
      .yes-no-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
      }
      .yes-no-btn {
        flex: 1;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: #fff;
        cursor: pointer;
        transition: 0.3s;
        text-align: center;
      }
      .yes-no-btn:hover,
      .yes-no-btn.selected {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.4);
      }
      .date-container {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: 1rem;
      }
      [dir="rtl"] .date-container {
        flex-direction: row-reverse;
      }

      /* loading */
      .loading-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.2) 0%,
          rgba(255, 255, 255, 0.05) 70%
        );
        margin: 0 auto 2rem;
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.7;
        }
        50% {
          transform: scale(1.05);
          opacity: 1;
        }
      }
      .loading-text {
        font-size: 1.1rem;
        font-weight: 300;
        opacity: 0.8;
      }

      /* results */
      .results-content {
        background: rgba(255, 255, 255, 0.95);
        color: #333;
        padding: 3rem;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        margin-bottom: 2rem;
        line-height: 1.8;
        font-size: 1.05rem;
      }
      .results-content strong {
        color: #16213e;
        font-weight: 600;
      }
      .results-content em {
        color: #666;
        font-style: italic;
      }
      .results-content p {
        margin-bottom: 1.5rem;
      }
      .results-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }
      .action-btn {
        padding: 1rem 2rem;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        color: #fff;
        text-decoration: none;
        cursor: pointer;
        transition: 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.95rem;
      }
      .action-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-2px);
      }
      .admin-notice {
        background: rgba(59, 130, 246, 0.2);
        border: 1px solid rgba(59, 130, 246, 0.4);
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        text-align: center;
        font-size: 0.9rem;
      }

      /* mobile */
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }
        .results-content {
          padding: 2rem;
        }
        .results-actions {
          flex-direction: column;
        }
        .date-container {
          flex-direction: column;
          align-items: stretch;
        }
        [dir="rtl"] .date-container {
          flex-direction: column;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  PHILOSOPHY  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
      <section id="philosophy" class="experience-section active">
        <p id="philosophyText" class="philosophy-text">
          Your dreams can only become true through clarity.
        </p>
        <button id="beginBtn" class="continue-btn" onclick="showAccessCode()">
          Begin
        </button>
      </section>

      <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ACCESS CODE  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
      <section id="accessCode" class="experience-section hidden">
        <p id="accessCodeText" class="philosophy-text">
          Please enter your verification code from the email
        </p>
        <div class="code-input-container">
          <input
            id="codeInput"
            class="code-input"
            type="text"
            maxlength="6"
            placeholder="000000"
          />
        </div>
        <button id="verifyCodeBtn" class="continue-btn" onclick="verifyCode()">
          Verify Code
        </button>
        <div
          id="errorMessage"
          class="error-message"
          style="display: none"
        ></div>
      </section>

      <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  QUESTIONS  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
      <section id="questions" class="experience-section hidden">
        <form id="reflectionForm" class="questions-form">
          <!-- Q1 -->
          <div class="question-group">
            <div id="q1Number" class="question-number">Question 1</div>
            <div id="q1Text" class="question-text">What is your dream?</div>
            <div id="q1Subtitle" class="question-subtitle">
              (Choose just one ‚Äî the one that calls you most right now.)
            </div>
            <textarea
              id="dreamInput"
              name="dream"
              class="question-textarea"
              required
            ></textarea>
          </div>

          <!-- Q2 -->
          <div class="question-group">
            <div id="q2Number" class="question-number">Question 2</div>
            <div id="q2Text" class="question-text">
              What is your plan for achieving this dream?
            </div>
            <div id="q2Subtitle" class="question-subtitle">
              (Write what you already know. It's okay if it's unclear.)
            </div>
            <textarea
              id="planInput"
              name="plan"
              class="question-textarea"
              required
            ></textarea>
          </div>

          <!-- Q3 -->
          <div class="question-group">
            <div id="q3Number" class="question-number">Question 3</div>
            <div id="q3Text" class="question-text">
              Have you set a definite date for fulfilling your dream?
            </div>
            <div class="yes-no-buttons">
              <div id="yesBtn" class="yes-no-btn" data-value="yes">Yes</div>
              <div id="noBtn" class="yes-no-btn" data-value="no">No</div>
            </div>
            <input type="hidden" name="hasDate" required />
            <div
              id="dateContainer"
              class="date-container"
              style="display: none"
            >
              <label id="dateLabel" style="opacity: 0.8"
                >What is the date?</label
              >
              <input type="date" name="dreamDate" class="question-input" />
            </div>
          </div>

          <!-- Q4 -->
          <div class="question-group">
            <div id="q4Number" class="question-number">Question 4</div>
            <div id="q4Text" class="question-text">
              What is your current relationship with this dream?
            </div>
            <div id="q4Subtitle" class="question-subtitle">
              (Do you believe you'll achieve it? Why or why not?)
            </div>
            <textarea
              id="relationshipInput"
              name="relationship"
              class="question-textarea"
              required
            ></textarea>
          </div>

          <!-- Q5 -->
          <div class="question-group">
            <div id="q5Number" class="question-number">Question 5</div>
            <div id="q5Text" class="question-text">
              What are you willing to give in return?
            </div>
            <div id="q5Subtitle" class="question-subtitle">
              (Energy, focus, love, time ‚Äî what will you offer?)
            </div>
            <textarea
              id="offeringInput"
              name="offering"
              class="question-textarea"
              required
            ></textarea>
          </div>

          <button id="submitBtn" class="continue-btn" type="submit">
            Receive Your Reflection
          </button>
        </form>
      </section>

      <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  LOADING  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
      <section id="loading" class="experience-section hidden">
        <div class="loading-circle"></div>
        <p id="loadingText" class="loading-text">Reflecting your truth‚Ä¶</p>
      </section>

      <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  RESULTS  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
      <section id="results" class="experience-section hidden">
        <div id="adminNotice" class="admin-notice" style="display: none">
          <span id="adminNoticeText"
            >‚ú® Admin session ‚Äì unlimited reflections</span
          >
        </div>
        <div id="reflectionContent" class="results-content"></div>
        <div class="results-actions">
          <button id="emailBtn" class="action-btn" onclick="emailReflection()">
            üìß <span id="emailText">Email This Reflection</span>
          </button>
          <a href="/" class="action-btn" id="reflectAgainBtn"
            >ü™û <span id="reflectAgainText">◊™◊®◊ê◊î ◊ê◊ï◊™◊ô ◊©◊ï◊ë</span></a
          >
        </div>
      </section>
    </div>

    <!--‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  SCRIPT  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ-->
    <script>
      /* language detection with sandbox-safe localStorage */
      let currentLanguage = (() => {
        try {
          return (
            new URLSearchParams(location.search).get("lang") ||
            localStorage.getItem("mirrorLanguage") ||
            "en"
          );
        } catch {
          return "en";
        }
      })();

      const t = {
        en: {
          philosophyText: "Your dreams can only become true through clarity.",
          beginBtn: "Begin",
          accessCodeText: "Please enter your verification code from the email",
          verifyCodeBtn: "Verify Code",
          q1Number: "Question 1",
          q1Text: "What is your dream?",
          q1Subtitle:
            "(Choose just one ‚Äî the one that calls you most right now.)",
          q2Number: "Question 2",
          q2Text: "What is your plan for achieving this dream?",
          q2Subtitle:
            "(Write what you already know. It's okay if it's unclear.)",
          q3Number: "Question 3",
          q3Text: "Have you set a definite date for fulfilling your dream?",
          q4Number: "Question 4",
          q4Text: "What is your current relationship with this dream?",
          q4Subtitle: "(Do you believe you'll achieve it? Why or why not?)",
          q5Number: "Question 5",
          q5Text: "What are you willing to give in return?",
          q5Subtitle: "(Energy, focus, love, time ‚Äî what will you offer?)",
          yesBtn: "Yes",
          noBtn: "No",
          dateLabel: "What is the date?",
          submitBtn: "Receive Your Reflection",
          loadingText: "Reflecting your truth‚Ä¶",
          emailText: "Email This Reflection",
          reflectAgainText: "Reflect Again",
          adminNoticeText: "‚ú® Admin session ‚Äì unlimited reflections",
          dreamPlaceholder: "Write the dream that calls you most‚Ä¶",
          planPlaceholder:
            "Share what you already know about the path forward‚Ä¶",
          relationshipPlaceholder:
            "How do you feel about this dream? Do you trust it?",
          offeringPlaceholder: "What are you ready to invest?",
          codePlaceholder: "000000",
          invalidCode: "Invalid or expired code. Please check your email.",
          errorVerifying: "Error verifying code. Please try again.",
        },
        he: {
          philosophyText: "◊î◊ó◊ú◊ï◊û◊ï◊™ ◊©◊ú◊ö ◊û◊™◊í◊©◊û◊ô◊ù ◊®◊ß ◊û◊™◊ï◊ö ◊ë◊î◊ô◊®◊ï◊™.",
          beginBtn: "◊î◊™◊ó◊ú",
          accessCodeText: "◊î◊ñ◊ü ◊ê◊™ ◊ß◊ï◊ì ◊î◊í◊ô◊©◊î ◊©◊ß◊ô◊ë◊ú◊™ ◊ë◊û◊ô◊ô◊ú",
          verifyCodeBtn: "◊ê◊û◊™ ◊ß◊ï◊ì",
          q1Number: "◊©◊ê◊ú◊î 1",
          q1Text: "◊û◊î◊ï ◊î◊ó◊ú◊ï◊ù ◊©◊ú◊ö?",
          q1Subtitle: "(◊ë◊ó◊® ◊ó◊ú◊ï◊ù ◊ê◊ó◊ì ‚Äî ◊ñ◊î ◊©◊ß◊ï◊®◊ê ◊ú◊ö ◊õ◊®◊í◊¢ ◊ó◊ñ◊ß ◊û◊õ◊ï◊ú.)",
          q2Number: "◊©◊ê◊ú◊î 2",
          q2Text: "◊û◊î ◊î◊™◊õ◊†◊ô◊™ ◊©◊ú◊ö ◊ú◊î◊í◊©◊ô◊ù ◊ê◊™ ◊î◊ó◊ú◊ï◊ù?",
          q2Subtitle: "(◊õ◊™◊ï◊ë ◊ê◊™ ◊û◊î ◊©◊õ◊ë◊® ◊ë◊®◊ï◊® ◊ú◊ö‚Äîeven ◊ê◊ù ◊ñ◊î ◊û◊¢◊ï◊®◊§◊ú.)",
          q3Number: "◊©◊ê◊ú◊î 3",
          q3Text: "◊î◊ê◊ù ◊ß◊ë◊¢◊™ ◊™◊ê◊®◊ô◊ö ◊ô◊¢◊ì ◊ú◊ó◊ú◊ï◊ù?",
          q4Number: "◊©◊ê◊ú◊î 4",
          q4Text: "◊û◊î ◊î◊ô◊ó◊°◊ô◊ù ◊©◊ú◊ö ◊¢◊ù ◊î◊ó◊ú◊ï◊ù ◊ë◊®◊í◊¢ ◊ñ◊î?",
          q4Subtitle: "(◊î◊ê◊ù ◊ê◊™◊î ◊û◊ê◊û◊ô◊ü ◊ë◊ï? ◊û◊ì◊ï◊¢ ◊õ◊ü / ◊ú◊ê?)",
          q5Number: "◊©◊ê◊ú◊î 5",
          q5Text: "◊û◊î ◊ê◊™◊î ◊û◊ï◊õ◊ü ◊ú◊î◊¢◊†◊ô◊ß ◊ë◊™◊û◊ï◊®◊î?",
          q5Subtitle: "(◊ê◊†◊®◊í◊ô◊î, ◊ñ◊û◊ü, ◊ê◊î◊ë◊î, ◊™◊©◊ï◊û◊™ ◊ú◊ë ‚Äî ◊û◊î ◊™◊™◊®◊ï◊ù?)",
          yesBtn: "◊õ◊ü",
          noBtn: "◊ú◊ê",
          dateLabel: "◊û◊î ◊î◊™◊ê◊®◊ô◊ö?",
          submitBtn: "◊ß◊ë◊ú ◊ê◊™ ◊î◊î◊©◊™◊ß◊§◊ï◊™",
          loadingText: "◊û◊©◊ß◊£ ◊ê◊™ ◊î◊ê◊û◊™ ◊©◊ú◊ö‚Ä¶",
          emailText: "◊©◊ú◊ó ◊ê◊™ ◊î◊î◊©◊™◊ß◊§◊ï◊™ ◊ë◊û◊ô◊ô◊ú",
          reflectAgainText: "◊™◊®◊ê◊î ◊ê◊ï◊™◊ô ◊©◊ï◊ë",
          adminNoticeText: "‚ú® ◊°◊©◊ü ◊û◊†◊î◊ú ‚Äì ◊î◊©◊™◊ß◊§◊ï◊ô◊ï◊™ ◊ú◊ú◊ê ◊î◊í◊ë◊ú◊î",
          dreamPlaceholder: "◊õ◊™◊ï◊ë ◊ê◊™ ◊î◊ó◊ú◊ï◊ù ◊©◊ß◊ï◊®◊ê ◊ú◊ö ◊ë◊ô◊ï◊™◊®‚Ä¶",
          planPlaceholder: "◊©◊™◊£ ◊ê◊™ ◊û◊î ◊©◊õ◊ë◊® ◊ë◊®◊ï◊® ◊ú◊ö ◊ú◊í◊ë◊ô ◊î◊ì◊®◊ö‚Ä¶",
          relationshipPlaceholder:
            "◊ê◊ô◊ö ◊ê◊™◊î ◊û◊®◊í◊ô◊© ◊õ◊ú◊§◊ô ◊î◊ó◊ú◊ï◊ù? ◊î◊ê◊ù ◊ê◊™◊î ◊°◊ï◊û◊ö ◊¢◊ú◊ô◊ï?",
          offeringPlaceholder: "◊û◊î ◊ê◊™◊î ◊û◊ï◊õ◊ü ◊ú◊î◊©◊ß◊ô◊¢?",
          codePlaceholder: "000000",
          invalidCode: "◊ß◊ï◊ì ◊©◊í◊ï◊ô ◊ê◊ï ◊©◊§◊í ◊™◊ï◊ß◊§◊ï. ◊ë◊ì◊ï◊ß ◊ê◊™ ◊î◊û◊ô◊ô◊ú ◊©◊ú◊ö.",
          errorVerifying: "◊©◊í◊ô◊ê◊î ◊ë◊ê◊ô◊û◊ï◊™ ◊î◊ß◊ï◊ì. ◊†◊°◊î ◊©◊ï◊ë.",
        },
      };

      function applyLang() {
        const L = t[currentLanguage];
        document.documentElement.dir = currentLanguage === "he" ? "rtl" : "ltr";
        document.documentElement.lang = currentLanguage;
        Object.entries(L).forEach(([k, v]) => {
          const el = document.getElementById(k);
          if (el) el.innerHTML = v;
        });
        dreamInput.placeholder = L.dreamPlaceholder;
        planInput.placeholder = L.planPlaceholder;
        relationshipInput.placeholder = L.relationshipPlaceholder;
        offeringInput.placeholder = L.offeringPlaceholder;
        codeInput.placeholder = L.codePlaceholder;
      }
      /* element refs for placeholders */
      const dreamInput = document.getElementById("dreamInput");
      const planInput = document.getElementById("planInput");
      const relationshipInput = document.getElementById("relationshipInput");
      const offeringInput = document.getElementById("offeringInput");
      const codeInput = document.getElementById("codeInput");
      applyLang();

      /* show/hide sections */
      function showSection(id) {
        document.querySelectorAll(".experience-section").forEach((s) => {
          s.classList.remove("active");
          setTimeout(() => s.classList.add("hidden"), 300);
        });
        setTimeout(() => {
          const s = document.getElementById(id);
          s.classList.remove("hidden");
          setTimeout(() => s.classList.add("active"), 20);
        }, 300);
      }
      function showAccessCode() {
        showSection("accessCode");
      }

      /* verification */
      function verifyCode() {
        const code = codeInput.value.trim();
        const err = document.getElementById("errorMessage");
        if (code.length !== 6) {
          err.textContent = t[currentLanguage].invalidCode;
          err.style.display = "block";
          return;
        }
        err.style.display = "none";
        fetch(`/api/send-access-code?code=${code}`)
          .then((r) => r.json())
          .then((d) => {
            if (d.success) {
              try {
                localStorage.removeItem("pendingPayment");
              } catch {}
              startQuestions();
            } else {
              throw 0;
            }
          })
          .catch(() => {
            err.textContent = t[currentLanguage].errorVerifying;
            err.style.display = "block";
            codeInput.value = "";
          });
      }

      /* questions logic */
      document.querySelectorAll(".yes-no-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          btn.parentNode
            .querySelectorAll(".yes-no-btn")
            .forEach((b) => b.classList.remove("selected"));
          btn.classList.add("selected");
          document.querySelector("input[name=hasDate]").value =
            btn.dataset.value;
          document.getElementById("dateContainer").style.display =
            btn.dataset.value === "yes" ? "flex" : "none";
        });
      });

      function startQuestions() {
        showSection("questions");
        document
          .querySelectorAll(".question-group")
          .forEach((q, i) =>
            setTimeout(() => q.classList.add("visible"), i * 200)
          );
      }

      /* form submit */
      document
        .getElementById("reflectionForm")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          showSection("loading");
          const fd = new FormData(e.target);
          fd.append("language", currentLanguage);
          fetch("/api/mirror-reflection", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(Object.fromEntries(fd)),
          })
            .then((r) => r.json())
            .then((d) => {
              if (d.success) {
                reflectionContent.innerHTML = d.reflection;
                showSection("results");
              } else throw new Error(d.error);
            })
            .catch((err) => {
              alert(err.message || "Server error");
              location.reload();
            });
        });

      /* email reflection */
      function emailReflection() {
        let pending;
        try {
          pending = JSON.parse(localStorage.getItem("pendingPayment") || "{}");
        } catch {
          pending = {};
        }
        if (!pending.email) {
          const e = prompt(
            currentLanguage === "he" ? "◊î◊õ◊†◊° ◊õ◊™◊ï◊ë◊™ ◊û◊ô◊ô◊ú" : "Enter email"
          );
          if (!e) return;
          pending.email = e;
        }
        fetch("/api/send-mirror-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            email: pending.email,
            content: reflectionContent.innerHTML,
            userName: pending.name || "Friend",
            language: currentLanguage,
          }),
        }).then(() => alert(currentLanguage === "he" ? "◊†◊©◊ú◊ó!" : "Sent!"));
      }

      /* admin mode */
      if (new URLSearchParams(location.search).get("admin") === "true") {
        document.getElementById("adminNotice").style.display = "block";
        startQuestions();
      }
    </script>
  </body>
</html>
