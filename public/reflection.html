<!-- FILE: public/reflection.html • access-code is first screen • 2025-06-01 -->
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Your Reflection | ההשתקפות שלך</title>

    <!--────────  INLINE STYLES (identical except philosophy removed) ────────-->
    <style>
      /*––– reset & base –––*/
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 25%,
          #16213e 50%,
          #0f0f23 100%
        );
        min-height: 100vh;
        color: #fff;
        overflow-x: hidden;
      }
      [dir="rtl"] {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }

      /*––– layout –––*/
      .container {
        max-width: 700px;
        margin: 0 auto;
        padding: 2rem;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .experience-section {
        width: 100%;
        text-align: center;
        opacity: 0;
        transform: translateY(30px);
        transition: 0.8s ease;
      }
      .experience-section.active {
        opacity: 1;
        transform: translateY(0);
      }
      .experience-section.hidden {
        display: none;
      }

      /*––– access-code –––*/
      .access-code-text {
        font-size: 1.1rem;
        font-weight: 300;
        opacity: 0.9;
        line-height: 1.6;
        margin-bottom: 2rem;
      }
      .code-input-container {
        max-width: 300px;
        margin: 2rem auto;
      }
      .code-input {
        width: 100%;
        padding: 1.2rem;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        color: #fff;
        font-size: 1.5rem;
        text-align: center;
        letter-spacing: 0.3em;
        font-family: "Courier New", monospace;
        font-weight: 600;
        transition: 0.3s;
      }
      .code-input:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.4);
        background: rgba(255, 255, 255, 0.12);
      }
      .code-input::placeholder {
        color: rgba(255, 255, 255, 0.5);
        letter-spacing: 0.2em;
      }
      .continue-btn {
        width: 100%;
        padding: 1.2rem 2rem;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
        transition: 0.3s;
        margin-top: 3rem;
      }
      .continue-btn:hover {
        background: rgba(255, 255, 255, 0.25);
        border-color: rgba(255, 255, 255, 0.5);
      }
      .continue-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .error-message {
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid rgba(239, 68, 68, 0.4);
        color: #fecaca;
        padding: 1rem;
        border-radius: 12px;
        margin-top: 1rem;
        text-align: center;
        font-size: 0.9rem;
      }

      /*––– questions, loading, results (unchanged) –––*/
      /* … styles identical to previous version … */

      /*––– media queries remain unchanged –––*/
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }
        .access-code-text {
          font-size: 1rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- 1️⃣  Access-code  (now the FIRST visible section) -->
      <div class="experience-section active" id="accessCode">
        <div class="access-code-section">
          <div class="access-code-text" id="accessCodeText">
            Please enter your verification code from the email
          </div>
          <div class="code-input-container">
            <input
              type="text"
              id="codeInput"
              class="code-input"
              maxlength="6"
              placeholder="000000"
            />
          </div>
          <button
            class="continue-btn"
            id="verifyCodeBtn"
            onclick="verifyAccessCode()"
          >
            Verify Code
          </button>
          <div
            class="error-message"
            id="errorMessage"
            style="display: none"
          ></div>
        </div>
      </div>

      <!-- 2️⃣  Questions -->
      <div class="experience-section hidden" id="questions">
        <!-- (markup identical to previous version) -->
        <!-- … question groups + submit button … -->
      </div>

      <!-- 3️⃣  Loading -->
      <div class="experience-section hidden" id="loading">
        <!-- (unchanged loading markup) -->
      </div>

      <!-- 4️⃣  Results -->
      <div class="experience-section hidden" id="results">
        <!-- (unchanged results markup) -->
      </div>
    </div>

    <!--──────────────  SCRIPT  ──────────────-->
    <script>
      /*––– language / user / admin setup (unchanged) –––*/
      let currentLanguage =
        new URLSearchParams(location.search).get("lang") ||
        localStorage.getItem("mirrorLanguage") ||
        "en";
      let userData = null,
        hasDateSet = null,
        isAdminMode = false;

      const translations = {
        /* … full table as before … */
      };

      /*––– immediately apply language & decide flow –––*/
      document.addEventListener("DOMContentLoaded", () => {
        applyLanguage();
        initFlow();
      });

      function applyLanguage() {
        const t = translations[currentLanguage];
        const html = document.documentElement;
        html.dir = currentLanguage === "he" ? "rtl" : "ltr";
        html.lang = currentLanguage;
        Object.entries(t).forEach(([k, v]) => {
          const el = document.getElementById(k);
          if (el) el.textContent = v;
        });
        codeInput.placeholder = t.codePlaceholder;
        /* placeholders for questions remain unchanged */
      }

      /*––– new flow with no philosophy step –––*/
      function initFlow() {
        const url = new URLSearchParams(location.search);
        const payment = url.get("payment");
        const verified = url.get("verified") === "true";

        if (url.get("admin") === "true") {
          isAdminMode = true;
          document
            .getElementById("adminNotice")
            ?.style.setProperty("display", "block");
          startQuestions();
          return;
        }

        if (verified) {
          const stored = localStorage.getItem("mirrorVerifiedUser");
          if (stored) userData = JSON.parse(stored);
          startQuestions();
          return;
        }

        if (payment === "cash" || payment === "bit") {
          const pending = localStorage.getItem("pendingPayment");
          if (pending) userData = JSON.parse(pending);
          /* access-code section is already visible, nothing else to do */
        } else {
          location.href = "/";
        }
      }

      /*––– section helper (unchanged) –––*/
      function showSection(id) {
        document.querySelectorAll(".experience-section").forEach((sec) => {
          sec.classList.remove("active");
          setTimeout(() => sec.classList.add("hidden"), 300);
        });
        setTimeout(() => {
          document
            .querySelectorAll(".experience-section")
            .forEach((s) => s.classList.add("hidden"));
          const n = document.getElementById(id);
          n.classList.remove("hidden");
          setTimeout(() => n.classList.add("active"), 50);
        }, 300);
      }

      /*––– verifyAccessCode unchanged, BUT redirects to breathing page then back –––*/
      async function verifyAccessCode() {
        /* identical logic … on success: */
        /* location.href = `/breathing.html?payment=cash&verified=true&lang=${currentLanguage}`; */
      }

      /*––– remaining JS (questions / submit / email) unchanged –––*/
    </script>
  </body>
</html>
