<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <title>
      Gift Mirror of Truth Access | Self-Discovery for Someone You Care About
    </title>
    <style>
      /* Self-Contained Gift Experience - Perfect Single Screen */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100vh;
        overflow: hidden;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 25%,
          #16213e 50%,
          #0f0f23 100%
        );
        color: #fff;
        font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
        position: fixed;
        width: 100vw;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Gentle cosmic background animation */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(
            circle at 20% 30%,
            rgba(59, 130, 246, 0.04) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 70%,
            rgba(16, 185, 129, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 50% 50%,
            rgba(147, 51, 234, 0.02) 0%,
            transparent 50%
          );
        z-index: 1;
        animation: gentleShift 45s ease-in-out infinite;
      }

      @keyframes gentleShift {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 0.7;
        }
        33% {
          transform: scale(1.05) rotate(120deg);
          opacity: 0.9;
        }
        66% {
          transform: scale(0.95) rotate(240deg);
          opacity: 0.6;
        }
      }

      /* Floating particles for ambiance */
      .floating-particles {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 2;
      }

      .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: rgba(251, 191, 36, 0.4);
        border-radius: 50%;
        animation: gentleFloat 25s linear infinite;
      }

      .particle:nth-child(1) {
        left: 10%;
        animation-delay: 0s;
      }
      .particle:nth-child(2) {
        left: 25%;
        animation-delay: 5s;
        background: rgba(16, 185, 129, 0.3);
      }
      .particle:nth-child(3) {
        left: 50%;
        animation-delay: 10s;
        background: rgba(147, 51, 234, 0.3);
      }
      .particle:nth-child(4) {
        left: 75%;
        animation-delay: 15s;
        background: rgba(59, 130, 246, 0.3);
      }
      .particle:nth-child(5) {
        left: 90%;
        animation-delay: 20s;
      }

      @keyframes gentleFloat {
        0% {
          transform: translateY(100vh) scale(0.5);
          opacity: 0;
        }
        10% {
          opacity: 0.8;
        }
        90% {
          opacity: 0.3;
        }
        100% {
          transform: translateY(-10vh) scale(1);
          opacity: 0;
        }
      }

      /* Navigation */
      .back-link {
        position: fixed;
        top: clamp(1rem, 2vh, 1.5rem);
        left: clamp(1rem, 2vw, 1.5rem);
        z-index: 100;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        padding: clamp(0.6rem, 1.5vh, 0.8rem) clamp(1rem, 2vw, 1.2rem);
        border-radius: 50px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        font-size: clamp(0.8rem, 1.8vw, 0.9rem);
        font-weight: 300;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        white-space: nowrap;
      }

      .back-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-2px);
      }

      /* Main container - perfectly centered and contained */
      .main-container {
        position: relative;
        z-index: 10;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: clamp(0.5rem, 1vh, 1rem) clamp(1rem, 2vw, 1.5rem);
        max-width: 100vw;
        margin: 0 auto;
        gap: clamp(0.5rem, 1vh, 0.8rem);
      }

      /* Header section */
      .header {
        text-align: center;
        flex-shrink: 0;
        margin-bottom: clamp(0.5rem, 1vh, 0.8rem);
      }

      .gift-icon {
        font-size: clamp(2rem, 4vw, 2.8rem);
        margin-bottom: clamp(0.4rem, 0.8vh, 0.6rem);
        display: block;
        animation: giftPulse 6s ease-in-out infinite;
        filter: drop-shadow(0 0 15px rgba(251, 191, 36, 0.3));
      }

      @keyframes giftPulse {
        0%,
        100% {
          transform: scale(1) rotate(0deg);
          opacity: 0.9;
        }
        50% {
          transform: scale(1.08) rotate(5deg);
          opacity: 1;
        }
      }

      .title {
        font-size: clamp(1.8rem, 4vw, 2.4rem);
        font-weight: 300;
        margin-bottom: clamp(0.3rem, 0.6vh, 0.4rem);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95) 0%,
          rgba(251, 191, 36, 0.8) 50%,
          rgba(255, 255, 255, 0.9) 100%
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        letter-spacing: 0.5px;
        line-height: 1.1;
      }

      .subtitle {
        font-size: clamp(0.95rem, 2.2vw, 1.2rem);
        opacity: 0.85;
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.4;
        font-weight: 300;
        margin-bottom: clamp(0.2rem, 0.4vh, 0.3rem);
      }

      .description {
        font-size: clamp(0.8rem, 1.8vw, 0.95rem);
        opacity: 0.7;
        color: rgba(255, 255, 255, 0.7);
        font-style: italic;
        max-width: clamp(280px, 50vw, 500px);
        line-height: 1.4;
      }

      /* Main form container - single card design */
      .gift-container {
        width: 100%;
        max-width: clamp(400px, 85vw, 900px);
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(40px) saturate(120%);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(20px, 3vw, 28px);
        padding: clamp(1.8rem, 3vh, 2.5rem);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3),
          0 0 0 1px rgba(255, 255, 255, 0.06);
        position: relative;
        overflow: hidden;
        flex-shrink: 0;
        animation: containerAppear 1.2s ease-out;
      }

      .gift-container::before {
        content: "";
        position: absolute;
        inset: 1px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08) 0%,
          rgba(251, 191, 36, 0.03) 30%,
          rgba(147, 51, 234, 0.02) 70%,
          rgba(255, 255, 255, 0.04) 100%
        );
        border-radius: clamp(19px, 3vw, 27px);
        pointer-events: none;
      }

      @keyframes containerAppear {
        0% {
          opacity: 0;
          transform: scale(0.95) translateY(30px);
          filter: blur(10px);
        }
        100% {
          opacity: 1;
          transform: scale(1) translateY(0);
          filter: blur(0);
        }
      }

      /* Grid layout for form and preview */
      .gift-content {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: clamp(2rem, 4vw, 3rem);
        align-items: start;
      }

      /* Form section */
      .form-section {
        display: flex;
        flex-direction: column;
        gap: clamp(1.2rem, 2.5vh, 1.6rem);
      }

      /* Messages */
      .message {
        padding: clamp(0.7rem, 1.4vh, 0.9rem);
        border-radius: clamp(10px, 2vw, 14px);
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
        text-align: center;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        font-weight: 300;
        margin-bottom: clamp(0.5rem, 1vh, 0.7rem);
      }

      .message.show {
        opacity: 1;
        transform: translateY(0);
      }

      .message.error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.2);
        color: rgba(252, 165, 165, 0.9);
      }

      .message.success {
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.2);
        color: rgba(110, 231, 183, 0.9);
      }

      .message.info {
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        color: rgba(147, 197, 253, 0.9);
      }

      /* Form groups */
      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: clamp(0.8rem, 1.6vw, 1.2rem);
      }

      .form-group {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: clamp(0.3rem, 0.6vh, 0.4rem);
      }

      .form-group.full-width {
        grid-column: 1 / -1;
      }

      .form-label {
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
        color: rgba(255, 255, 255, 0.8);
        font-weight: 400;
        letter-spacing: 0.3px;
      }

      .form-input {
        padding: clamp(0.9rem, 1.8vh, 1.1rem);
        background: rgba(255, 255, 255, 0.06);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: clamp(10px, 2vw, 14px);
        color: #fff;
        font-size: clamp(0.85rem, 1.8vw, 0.95rem);
        font-family: inherit;
        transition: all 0.3s ease;
        font-weight: 300;
        outline: none;
        -webkit-tap-highlight-color: transparent;
      }

      .form-input:focus {
        border-color: rgba(16, 185, 129, 0.4);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
        transform: translateY(-1px);
      }

      .form-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        font-style: italic;
        font-weight: 300;
      }

      .form-textarea {
        min-height: clamp(70px, 14vh, 90px);
        resize: none;
        line-height: 1.5;
        font-family: inherit;
      }

      .char-counter {
        text-align: right;
        font-size: clamp(0.7rem, 1.4vw, 0.8rem);
        color: rgba(255, 255, 255, 0.5);
        margin-top: 0.2rem;
        transition: color 0.3s ease;
      }

      /* Selection sections */
      .selection-section {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: clamp(12px, 2.4vw, 16px);
        padding: clamp(1.2rem, 2.4vh, 1.6rem);
        position: relative;
        overflow: hidden;
      }

      .selection-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 100%
        );
      }

      .section-title {
        font-size: clamp(0.95rem, 2vw, 1.1rem);
        font-weight: 500;
        margin-bottom: clamp(0.8rem, 1.6vh, 1rem);
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        gap: 0.6rem;
        letter-spacing: 0.3px;
      }

      .section-title::before {
        content: "‚ú®";
        font-size: 0.9em;
        opacity: 0.8;
      }

      /* Tier selection */
      .tier-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: clamp(0.8rem, 1.6vw, 1rem);
        margin-bottom: clamp(1rem, 2vh, 1.3rem);
      }

      .tier-option {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: clamp(10px, 2vw, 14px);
        padding: clamp(1rem, 2vh, 1.3rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .tier-option::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.1) 0%,
          rgba(59, 130, 246, 0.08) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .tier-option:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .tier-option:hover::before {
        opacity: 0.3;
      }

      .tier-option.selected {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.3);
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        transform: translateY(-1px);
      }

      .tier-option.selected::before {
        opacity: 1;
      }

      .tier-option.premium {
        position: relative;
        padding-top: clamp(1.5rem, 3vh, 2rem);
      }

      .premium-badge {
        position: absolute;
        top: -6px;
        right: -6px;
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        padding: clamp(0.3rem, 0.6vh, 0.4rem) clamp(0.6rem, 1.2vw, 0.8rem);
        border-radius: 8px;
        font-size: clamp(0.6rem, 1.2vw, 0.7rem);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 3px 10px rgba(245, 158, 11, 0.4);
      }

      .tier-name {
        font-size: clamp(0.9rem, 1.9vw, 1rem);
        font-weight: 500;
        margin-bottom: clamp(0.4rem, 0.8vh, 0.5rem);
        color: rgba(255, 255, 255, 0.95);
      }

      .tier-description {
        font-size: clamp(0.7rem, 1.5vw, 0.8rem);
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.3;
      }

      /* Duration selection */
      .duration-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(0.6rem, 1.2vw, 0.8rem);
      }

      .duration-option {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: clamp(8px, 1.6vw, 12px);
        padding: clamp(0.8rem, 1.6vh, 1rem);
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        position: relative;
        overflow: hidden;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .duration-option::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.1) 0%,
          rgba(147, 51, 234, 0.08) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .duration-option:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-1px);
      }

      .duration-option:hover::before {
        opacity: 0.3;
      }

      .duration-option.selected {
        background: rgba(251, 191, 36, 0.1);
        border-color: rgba(251, 191, 36, 0.3);
        box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
      }

      .duration-option.selected::before {
        opacity: 1;
      }

      .duration-name {
        font-size: clamp(0.75rem, 1.6vw, 0.85rem);
        font-weight: 500;
        margin-bottom: clamp(0.3rem, 0.6vh, 0.4rem);
        color: rgba(255, 255, 255, 0.9);
      }

      .duration-price {
        font-size: clamp(0.9rem, 1.9vw, 1rem);
        font-weight: 600;
        color: #10b981;
      }

      /* Payment section */
      .payment-section {
        margin-top: clamp(1rem, 2vh, 1.5rem);
        padding: clamp(1.2rem, 2.4vh, 1.6rem);
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: clamp(12px, 2.4vw, 16px);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .payment-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(16, 185, 129, 0.6) 50%,
          transparent 100%
        );
      }

      .total-amount {
        font-size: clamp(1.6rem, 3.4vw, 2rem);
        font-weight: 600;
        margin-bottom: clamp(0.3rem, 0.6vh, 0.4rem);
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .total-description {
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: clamp(1rem, 2vh, 1.3rem);
      }

      #paypal-button-container {
        min-height: clamp(45px, 9vh, 55px);
        border-radius: clamp(8px, 1.6vw, 12px);
        overflow: hidden;
        opacity: 0.5;
        transition: opacity 0.3s ease;
      }

      #paypal-button-container.enabled {
        opacity: 1;
      }

      .paypal-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: clamp(0.8rem, 1.6vw, 1rem);
        padding: clamp(1rem, 2vh, 1.3rem);
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: clamp(8px, 1.6vw, 12px);
        color: #93c5fd;
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
      }

      .loading-spinner {
        width: clamp(16px, 3.2vw, 18px);
        height: clamp(16px, 3.2vw, 18px);
        border: 2px solid rgba(147, 197, 253, 0.3);
        border-radius: 50%;
        border-top-color: #93c5fd;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .processing-message {
        display: none;
        text-align: center;
        padding: clamp(1rem, 2vh, 1.3rem);
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: clamp(8px, 1.6vw, 12px);
        color: #93c5fd;
        margin-top: clamp(0.8rem, 1.6vh, 1rem);
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
      }

      /* Preview section */
      .preview-section {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: clamp(12px, 2.4vw, 16px);
        padding: clamp(1.5rem, 3vh, 2rem);
        height: fit-content;
        position: relative;
        overflow: hidden;
      }

      .preview-section::before {
        content: "";
        position: absolute;
        top: 10%;
        right: -10%;
        width: 120px;
        height: 120px;
        background: radial-gradient(
          circle,
          rgba(251, 191, 36, 0.15) 0%,
          rgba(147, 51, 234, 0.1) 50%,
          transparent 70%
        );
        border-radius: 50%;
        animation: previewGlow 8s ease-in-out infinite;
        filter: blur(20px);
      }

      @keyframes previewGlow {
        0%,
        100% {
          opacity: 0.6;
          transform: scale(1) rotate(0deg);
        }
        50% {
          opacity: 0.9;
          transform: scale(1.2) rotate(180deg);
        }
      }

      .preview-header {
        text-align: center;
        margin-bottom: clamp(1.2rem, 2.4vh, 1.6rem);
        position: relative;
        z-index: 2;
      }

      .preview-icon {
        font-size: clamp(2rem, 4vw, 2.5rem);
        margin-bottom: clamp(0.6rem, 1.2vh, 0.8rem);
        display: block;
        animation: giftFloat 5s ease-in-out infinite;
      }

      @keyframes giftFloat {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-8px) rotate(5deg);
        }
      }

      .preview-title {
        font-size: clamp(1.1rem, 2.4vw, 1.3rem);
        font-weight: 500;
        margin-bottom: clamp(0.4rem, 0.8vh, 0.5rem);
        color: rgba(255, 255, 255, 0.95);
      }

      .preview-subtitle {
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
        color: rgba(255, 255, 255, 0.7);
        font-style: italic;
      }

      .preview-benefits {
        display: flex;
        flex-direction: column;
        gap: clamp(0.8rem, 1.6vh, 1rem);
        position: relative;
        z-index: 2;
      }

      .benefit-item {
        display: flex;
        align-items: center;
        gap: clamp(0.8rem, 1.6vw, 1rem);
        padding: clamp(0.8rem, 1.6vh, 1rem);
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: clamp(8px, 1.6vw, 12px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .benefit-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 2px;
        background: linear-gradient(
          180deg,
          rgba(16, 185, 129, 0.8) 0%,
          rgba(59, 130, 246, 0.6) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .benefit-item:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.15);
        transform: translateX(4px);
      }

      .benefit-item:hover::before {
        opacity: 1;
      }

      .benefit-icon {
        font-size: clamp(1.2rem, 2.6vw, 1.4rem);
        flex-shrink: 0;
      }

      .benefit-text {
        font-size: clamp(0.8rem, 1.7vw, 0.9rem);
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.4;
      }

      .benefit-premium {
        display: none;
      }

      .preview-note {
        margin-top: clamp(1.2rem, 2.4vh, 1.6rem);
        padding: clamp(1rem, 2vh, 1.3rem);
        background: rgba(59, 130, 246, 0.08);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: clamp(8px, 1.6vw, 12px);
        position: relative;
        z-index: 2;
      }

      .note-title {
        font-size: clamp(0.85rem, 1.8vw, 0.95rem);
        font-weight: 500;
        margin-bottom: clamp(0.4rem, 0.8vh, 0.5rem);
        color: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .note-text {
        font-size: clamp(0.75rem, 1.6vw, 0.85rem);
        line-height: 1.4;
        color: rgba(255, 255, 255, 0.7);
      }

      /* Loading states */
      .form-disabled {
        opacity: 0.6;
        pointer-events: none;
      }

      /* Responsive design */
      @media (max-width: 1024px) {
        .gift-content {
          grid-template-columns: 1fr;
          gap: clamp(1.5rem, 3vh, 2rem);
        }

        .preview-section {
          order: -1;
        }

        .main-container {
          padding-top: clamp(4rem, 8vh, 6rem);
          padding-bottom: clamp(1rem, 2vh, 1.5rem);
          justify-content: flex-start;
          height: auto;
          min-height: 100vh;
          overflow-y: auto;
        }

        .gift-container {
          max-width: 95vw;
        }
      }

      @media (max-width: 768px) {
        .form-row {
          grid-template-columns: 1fr;
          gap: clamp(0.8rem, 1.6vh, 1rem);
        }

        .tier-grid {
          grid-template-columns: 1fr;
        }

        .duration-grid {
          grid-template-columns: 1fr;
        }

        .main-container {
          padding-top: clamp(3.5rem, 7vh, 5rem);
        }
      }

      @media (max-width: 480px) {
        .gift-container {
          padding: clamp(1.5rem, 3vh, 2rem);
          max-width: 98vw;
        }

        .main-container {
          padding: clamp(0.3rem, 0.6vh, 0.5rem) clamp(0.5rem, 1vw, 0.8rem);
          padding-top: clamp(3rem, 6vh, 4rem);
        }
      }

      /* Mobile landscape optimization */
      @media (max-height: 600px) and (orientation: landscape) {
        .main-container {
          justify-content: flex-start;
          padding-top: clamp(2rem, 4vh, 3rem);
        }

        .description {
          display: none;
        }
      }

      /* Accessibility and motion preferences */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Focus styles for accessibility */
      .tier-option:focus-visible,
      .duration-option:focus-visible,
      .form-input:focus-visible,
      .back-link:focus-visible {
        outline: 2px solid rgba(16, 185, 129, 0.6);
        outline-offset: 2px;
      }

      /* Remove default focus outlines */
      * {
        outline: none !important;
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  </head>

  <body>
    <!-- Floating particles for ambiance -->
    <div class="floating-particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>

    <!-- Navigation -->
    <a href="/" class="back-link">
      <span>‚Üê</span>
      <span>Return to Portal</span>
    </a>

    <!-- Main container -->
    <div class="main-container">
      <!-- Header -->
      <div class="header">
        <div class="gift-icon">üéÅ</div>
        <h1 class="title">Gift Mirror of Truth Access</h1>
        <p class="subtitle">
          Share the power of self-discovery with someone you care about
        </p>
        <p class="description">
          AI-powered reflection and pattern recognition for personal growth
        </p>
      </div>

      <!-- Gift container -->
      <div class="gift-container">
        <div class="gift-content">
          <!-- Form section -->
          <div class="form-section">
            <!-- Messages -->
            <div
              class="message error"
              id="errorMessage"
              style="display: none"
            ></div>
            <div
              class="message success"
              id="successMessage"
              style="display: none"
            ></div>
            <div
              class="message info"
              id="infoMessage"
              style="display: none"
            ></div>

            <!-- Gift form -->
            <form id="giftForm">
              <!-- Gift details -->
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Your name</label>
                  <input
                    type="text"
                    id="giverName"
                    class="form-input"
                    placeholder="Your full name"
                    required
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Your email</label>
                  <input
                    type="email"
                    id="giverEmail"
                    class="form-input"
                    placeholder="your@email.com"
                    required
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Recipient's name</label>
                  <input
                    type="text"
                    id="recipientName"
                    class="form-input"
                    placeholder="Who will receive this gift?"
                    required
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">Recipient's email</label>
                  <input
                    type="email"
                    id="recipientEmail"
                    class="form-input"
                    placeholder="their@email.com"
                    required
                  />
                </div>
              </div>

              <div class="form-group full-width">
                <label class="form-label">Personal message (optional)</label>
                <textarea
                  id="personalMessage"
                  class="form-input form-textarea"
                  placeholder="Why are you sharing this journey of self-discovery with them?"
                  maxlength="200"
                ></textarea>
                <div class="char-counter">
                  <span id="charCount">0</span>/200 characters
                </div>
              </div>

              <!-- Tier selection -->
              <div class="selection-section">
                <h3 class="section-title">Choose access level</h3>
                <div class="tier-grid">
                  <div class="tier-option" data-tier="essential">
                    <div class="tier-name">Essential</div>
                    <div class="tier-description">
                      5 reflections/month<br />
                      Pattern insights<br />
                      Growth tracking
                    </div>
                  </div>
                  <div class="tier-option premium" data-tier="premium">
                    <div class="premium-badge">Most Popular</div>
                    <div class="tier-name">Premium</div>
                    <div class="tier-description">
                      10 reflections/month<br />
                      Advanced AI analysis<br />
                      Deep insights
                    </div>
                  </div>
                </div>

                <h3 class="section-title">Choose duration</h3>
                <div class="duration-grid">
                  <div class="duration-option" data-duration="1mo">
                    <div class="duration-name">1 Month</div>
                    <div class="duration-price" id="price1mo">$4.99</div>
                  </div>
                  <div class="duration-option" data-duration="3mo">
                    <div class="duration-name">3 Months</div>
                    <div class="duration-price" id="price3mo">$14.97</div>
                  </div>
                  <div class="duration-option" data-duration="1yr">
                    <div class="duration-name">1 Year</div>
                    <div class="duration-price" id="price1yr">$49.99</div>
                  </div>
                </div>
              </div>

              <!-- Payment section -->
              <div class="payment-section">
                <div class="total-amount" id="totalAmount">$4.99</div>
                <div class="total-description" id="totalDescription">
                  Essential ‚Ä¢ 1 Month
                </div>

                <div class="paypal-loading" id="paypalLoading">
                  <div class="loading-spinner"></div>
                  <span>Loading payment options...</span>
                </div>

                <div id="paypal-button-container"></div>

                <div class="processing-message" id="processingMessage">
                  ‚è≥ Creating their invitation and setting up access...
                </div>
              </div>
            </form>
          </div>

          <!-- Preview section -->
          <div class="preview-section">
            <div class="preview-header">
              <div class="preview-icon">üìß</div>
              <h3 class="preview-title">What they'll receive</h3>
              <p class="preview-subtitle">
                A complete self-discovery experience
              </p>
            </div>

            <div class="preview-benefits">
              <div class="benefit-item">
                <div class="benefit-icon">‚ú®</div>
                <div class="benefit-text">Beautiful welcome invitation</div>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">üö™</div>
                <div class="benefit-text">Instant platform access</div>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">ü§ñ</div>
                <div class="benefit-text">AI-powered pattern recognition</div>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">üìä</div>
                <div class="benefit-text">Personal growth dashboard</div>
              </div>
              <div class="benefit-item benefit-premium">
                <div class="benefit-icon">üß†</div>
                <div class="benefit-text">Extended AI thinking time</div>
              </div>
              <div class="benefit-item">
                <div class="benefit-icon">‚è∞</div>
                <div class="benefit-text">
                  <span id="durationDisplay">One month</span> of reflections
                </div>
              </div>
            </div>

            <div class="preview-note">
              <div class="note-title">
                <span>üí°</span>
                <span>How it works</span>
              </div>
              <div class="note-text">
                They'll receive an email invitation with immediate access to
                their chosen subscription tier for the full duration you select.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Self-Contained Gift Experience - Perfect Single Screen
      let paypalConfig = null;
      let paypalInitialized = false;
      let selectedTier = "essential";
      let selectedDuration = "1mo";
      let currentAmount = "4.99";
      let giftPricing = {};
      let isProcessing = false;

      // Initialize the gift experience
      document.addEventListener("DOMContentLoaded", function () {
        initializeGiftExperience();
      });

      async function initializeGiftExperience() {
        setupEventListeners();
        await loadGiftPricing();
        await loadPayPalConfiguration();
        initializeSelections();
        setupFormValidation();
        console.log("üéÅ Gift experience initialized");
      }

      function setupEventListeners() {
        // Form validation
        ["giverName", "giverEmail", "recipientName", "recipientEmail"].forEach(
          (id) => {
            document.getElementById(id).addEventListener("input", validateForm);
            document.getElementById(id).addEventListener("blur", validateField);
          }
        );

        // Personal message counter
        const messageInput = document.getElementById("personalMessage");
        const charCount = document.getElementById("charCount");

        messageInput.addEventListener("input", function () {
          const length = this.value.length;
          charCount.textContent = length;

          const counter = document.querySelector(".char-counter");
          if (length > 150) {
            counter.style.color = "#ef4444";
          } else if (length > 100) {
            counter.style.color = "#f59e0b";
          } else {
            counter.style.color = "rgba(255, 255, 255, 0.5)";
          }
        });

        // Name formatting
        ["giverName", "recipientName"].forEach((id) => {
          document.getElementById(id).addEventListener("blur", function () {
            this.value = this.value.replace(/\b\w/g, (l) => l.toUpperCase());
          });
        });

        // Tier selection
        document.querySelectorAll(".tier-option").forEach((option) => {
          option.addEventListener("click", function () {
            selectTier(this.dataset.tier);
          });
        });

        // Duration selection
        document.querySelectorAll(".duration-option").forEach((option) => {
          option.addEventListener("click", function () {
            selectDuration(this.dataset.duration);
          });
        });

        // Form submission
        document
          .getElementById("giftForm")
          .addEventListener("submit", handleGiftPurchase);
      }

      async function loadGiftPricing() {
        try {
          const response = await fetch("/api/subscriptions?action=get-pricing");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          const result = await response.json();
          if (!result.success)
            throw new Error(result.error || "Failed to load pricing");

          giftPricing = result.pricing.gifts;
          updatePricingDisplay();
        } catch (error) {
          console.error("Pricing error:", error);
          // Fallback pricing
          giftPricing = {
            essential: { "1mo": 4.99, "3mo": 14.97, "1yr": 49.99 },
            premium: { "1mo": 9.99, "3mo": 29.97, "1yr": 99.99 },
          };
          updatePricingDisplay();
        }
      }

      function updatePricingDisplay() {
        document.getElementById(
          "price1mo"
        ).textContent = `$${giftPricing[selectedTier]["1mo"]}`;
        document.getElementById(
          "price3mo"
        ).textContent = `$${giftPricing[selectedTier]["3mo"]}`;
        document.getElementById(
          "price1yr"
        ).textContent = `$${giftPricing[selectedTier]["1yr"]}`;

        currentAmount = giftPricing[selectedTier][selectedDuration].toString();
        updateTotalDisplay();
      }

      function initializeSelections() {
        selectTier("essential");
        selectDuration("1mo");
      }

      function selectTier(tier) {
        selectedTier = tier;

        // Update tier selection UI
        document.querySelectorAll(".tier-option").forEach((option) => {
          option.classList.remove("selected");
        });
        document
          .querySelector(`[data-tier="${tier}"]`)
          .classList.add("selected");

        // Show/hide premium benefits
        const premiumBenefits = document.querySelectorAll(".benefit-premium");
        premiumBenefits.forEach((benefit) => {
          benefit.style.display = tier === "premium" ? "flex" : "none";
        });

        updatePricingDisplay();
        createSelectionEffect(document.querySelector(`[data-tier="${tier}"]`));

        if (paypalInitialized) {
          reinitializePayPal();
        }
      }

      function selectDuration(duration) {
        selectedDuration = duration;

        // Update duration selection UI
        document.querySelectorAll(".duration-option").forEach((option) => {
          option.classList.remove("selected");
        });
        document
          .querySelector(`[data-duration="${duration}"]`)
          .classList.add("selected");

        // Update duration display
        const durationText =
          duration === "1mo"
            ? "One month"
            : duration === "3mo"
            ? "Three months"
            : "One year";
        document.getElementById("durationDisplay").textContent = durationText;

        currentAmount = giftPricing[selectedTier][duration].toString();
        updateTotalDisplay();
        createSelectionEffect(
          document.querySelector(`[data-duration="${duration}"]`)
        );

        if (paypalInitialized) {
          reinitializePayPal();
        }
      }

      function updateTotalDisplay() {
        const tierName =
          selectedTier.charAt(0).toUpperCase() + selectedTier.slice(1);
        const durationText =
          selectedDuration === "1mo"
            ? "1 Month"
            : selectedDuration === "3mo"
            ? "3 Months"
            : "1 Year";

        document.getElementById(
          "totalAmount"
        ).textContent = `$${currentAmount}`;
        document.getElementById(
          "totalDescription"
        ).textContent = `${tierName} ‚Ä¢ ${durationText}`;
      }

      async function loadPayPalConfiguration() {
        try {
          const response = await fetch("/api/payment?action=config");
          if (!response.ok) throw new Error(`HTTP ${response.status}`);

          const result = await response.json();
          if (!result.success)
            throw new Error(result.error || "PayPal configuration failed");

          paypalConfig = result.config;
          await loadPayPalSDK();
        } catch (error) {
          console.error("PayPal configuration error:", error);
          showMessage(
            "Payment system initialization failed. Please refresh the page.",
            "error"
          );
        }
      }

      function loadPayPalSDK() {
        return new Promise((resolve, reject) => {
          if (window.paypal && window.paypal.Buttons) {
            hidePayPalLoading();
            initializePayPal();
            resolve();
            return;
          }

          const script = document.createElement("script");
          script.src = `https://www.paypal.com/sdk/js?client-id=${paypalConfig.clientId}&currency=${paypalConfig.currency}&intent=capture`;

          const timeout = setTimeout(() => {
            reject(new Error("PayPal loading timeout"));
          }, 15000);

          script.onload = () => {
            clearTimeout(timeout);
            setTimeout(() => {
              if (window.paypal && window.paypal.Buttons) {
                hidePayPalLoading();
                initializePayPal();
                resolve();
              } else {
                reject(new Error("PayPal loaded but not available"));
              }
            }, 100);
          };

          script.onerror = () => {
            clearTimeout(timeout);
            reject(new Error("Failed to load PayPal"));
          };

          document.head.appendChild(script);
        });
      }

      function hidePayPalLoading() {
        document.getElementById("paypalLoading").style.display = "none";
      }

      function validateForm() {
        const giverName = document.getElementById("giverName").value.trim();
        const giverEmail = document.getElementById("giverEmail").value.trim();
        const recipientName = document
          .getElementById("recipientName")
          .value.trim();
        const recipientEmail = document
          .getElementById("recipientEmail")
          .value.trim();

        const isValid =
          giverName &&
          validateEmail(giverEmail) &&
          recipientName &&
          validateEmail(recipientEmail);

        const paypalContainer = document.getElementById(
          "paypal-button-container"
        );
        if (paypalContainer) {
          if (isValid) {
            paypalContainer.classList.add("enabled");
          } else {
            paypalContainer.classList.remove("enabled");
          }
        }

        return isValid;
      }

      function validateField(event) {
        const field = event.target;
        const value = field.value.trim();

        if (field.type === "email") {
          if (value && !validateEmail(value)) {
            field.style.borderColor = "rgba(239, 68, 68, 0.4)";
          } else {
            field.style.borderColor = "";
          }
        } else if (field.type === "text") {
          if (value && value.length < 2) {
            field.style.borderColor = "rgba(245, 158, 11, 0.4)";
          } else {
            field.style.borderColor = "";
          }
        }
      }

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function setupFormValidation() {
        validateForm();
      }

      function reinitializePayPal() {
        const container = document.getElementById("paypal-button-container");
        container.innerHTML = "";
        paypalInitialized = false;
        initializePayPal();
      }

      function initializePayPal() {
        if (!window.paypal || !window.paypal.Buttons) {
          showMessage(
            "Payment system not available. Please refresh the page.",
            "error"
          );
          return;
        }

        if (!paypalConfig) {
          showMessage(
            "Payment configuration missing. Please refresh the page.",
            "error"
          );
          return;
        }

        if (paypalInitialized) return;

        try {
          window.paypal
            .Buttons({
              style: {
                color: "gold",
                shape: "rect",
                label: "pay",
                height: 50,
                tagline: false,
              },

              onClick: function (data, actions) {
                if (!validateForm()) {
                  showMessage(
                    "Please fill in all required fields with valid information.",
                    "error"
                  );
                  return actions.reject();
                }
                return actions.resolve();
              },

              createOrder: function (data, actions) {
                const giverName = document
                  .getElementById("giverName")
                  .value.trim();
                const giverEmail = document
                  .getElementById("giverEmail")
                  .value.trim();
                const tierName =
                  selectedTier.charAt(0).toUpperCase() + selectedTier.slice(1);
                const durationText =
                  selectedDuration === "1mo"
                    ? "1 Month"
                    : selectedDuration === "3mo"
                    ? "3 Months"
                    : "1 Year";

                const orderData = {
                  purchase_units: [
                    {
                      amount: {
                        value: currentAmount,
                        currency_code: paypalConfig.currency,
                      },
                      description: `Mirror of Truth - ${tierName} Gift (${durationText})`,
                    },
                  ],
                };

                if (giverEmail && validateEmail(giverEmail)) {
                  orderData.payer = {
                    email_address: giverEmail,
                    name: {
                      given_name: giverName.split(" ")[0] || giverName,
                      surname: giverName.split(" ").slice(1).join(" ") || "",
                    },
                  };
                }

                return actions.order.create(orderData);
              },

              onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                  handleGiftCompletion(details);
                });
              },

              onError: function (err) {
                console.error("PayPal error:", err);
                showMessage("Payment error. Please try again.", "error");
                resetProcessingState();
              },

              onCancel: function (data) {
                resetProcessingState();
              },
            })
            .render("#paypal-button-container")
            .then(() => {
              paypalInitialized = true;
              validateForm();
            })
            .catch((error) => {
              console.error("PayPal render error:", error);
              showMessage(
                "Payment system initialization failed. Please refresh the page.",
                "error"
              );
            });
        } catch (error) {
          console.error("PayPal initialization error:", error);
          showMessage(
            "Payment system error. Please refresh the page.",
            "error"
          );
        }
      }

      async function handleGiftCompletion(paymentDetails) {
        setProcessingState(true);

        try {
          const giftData = {
            giverName: document.getElementById("giverName").value.trim(),
            giverEmail: document.getElementById("giverEmail").value.trim(),
            recipientName: document
              .getElementById("recipientName")
              .value.trim(),
            recipientEmail: document
              .getElementById("recipientEmail")
              .value.trim(),
            personalMessage: document
              .getElementById("personalMessage")
              .value.trim(),
            subscriptionTier: selectedTier,
            subscriptionDuration: selectedDuration,
            amount: parseFloat(currentAmount),
            paymentMethod: "paypal",
            paymentId: paymentDetails.id,
          };

          const response = await fetch("/api/subscriptions", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: "gift-subscription",
              ...giftData,
            }),
          });

          const result = await response.json();

          if (!result.success) {
            throw new Error(result.error || "Failed to create gift");
          }

          const tierName =
            selectedTier.charAt(0).toUpperCase() + selectedTier.slice(1);
          const durationText =
            selectedDuration === "1mo"
              ? "one month"
              : selectedDuration === "3mo"
              ? "three months"
              : "one year";

          showMessage(
            `üéÅ Gift successfully created! ${giftData.recipientName} will receive ${durationText} of ${tierName} access.`,
            "success"
          );

          setTimeout(() => {
            window.location.href = "/";
          }, 3000);
        } catch (error) {
          console.error("Gift creation error:", error);
          showMessage(
            "Gift was paid for but invitation creation failed. Please contact support.",
            "error"
          );
          setTimeout(() => {
            window.location.href = "/";
          }, 5000);
        }
      }

      function handleGiftPurchase(event) {
        event.preventDefault();
        // PayPal handles the actual purchase flow
      }

      function setProcessingState(processing) {
        isProcessing = processing;
        const form = document.getElementById("giftForm");
        const processingMessage = document.getElementById("processingMessage");

        if (processing) {
          form.classList.add("form-disabled");
          processingMessage.style.display = "block";
        } else {
          form.classList.remove("form-disabled");
          processingMessage.style.display = "none";
        }
      }

      function resetProcessingState() {
        setProcessingState(false);
      }

      function showMessage(message, type) {
        const messageDiv = document.getElementById(`${type}Message`);
        if (!messageDiv) return;

        // Hide all messages first
        hideMessages();

        messageDiv.textContent = message;
        messageDiv.style.display = "block";

        requestAnimationFrame(() => {
          messageDiv.classList.add("show");
        });

        if (type === "error") {
          setTimeout(hideMessages, 6000);
        } else if (type === "success") {
          setTimeout(hideMessages, 8000);
        }
      }

      function hideMessages() {
        ["errorMessage", "successMessage", "infoMessage"].forEach((id) => {
          const div = document.getElementById(id);
          if (div) {
            div.classList.remove("show");
            setTimeout(() => (div.style.display = "none"), 300);
          }
        });
      }

      function createSelectionEffect(element) {
        const rect = element.getBoundingClientRect();
        for (let i = 0; i < 3; i++) {
          setTimeout(() => {
            const effect = document.createElement("div");
            const offsetX = (Math.random() - 0.5) * 80;
            const offsetY = (Math.random() - 0.5) * 80;

            effect.style.cssText = `
              position: fixed;
              left: ${rect.left + rect.width / 2 + offsetX}px;
              top: ${rect.top + rect.height / 2 + offsetY}px;
              width: 4px;
              height: 4px;
              background: radial-gradient(circle, rgba(16, 185, 129, 1) 0%, rgba(251, 191, 36, 0.8) 60%, transparent 90%);
              border-radius: 50%;
              pointer-events: none;
              z-index: 1000;
              animation: selectionEffect 2s ease-out forwards;
            `;

            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 2000);
          }, i * 50);
        }
      }

      // Add selection effect animation
      const effectStyle = document.createElement("style");
      effectStyle.textContent = `
        @keyframes selectionEffect {
          0% { opacity: 0; transform: scale(0) rotate(0deg); }
          50% { opacity: 1; transform: scale(1.5) rotate(180deg); }
          100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
      `;
      document.head.appendChild(effectStyle);

      // Debug (development only)
      if (window.location.hostname === "localhost") {
        window.giftDebug = {
          selectedTier: () => selectedTier,
          selectedDuration: () => selectedDuration,
          currentAmount: () => currentAmount,
          pricing: () => giftPricing,
          validateForm: validateForm,
          testMessage: (msg, type) => showMessage(msg, type),
        };
      }
    </script>
  </body>
</html>
