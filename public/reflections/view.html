<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <title>Reflection | Mirror of Truth</title>

    <style>
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REFLECTION VIEW - CONSOLIDATED â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

      /* â•­â”€ RESET & FOUNDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
      }

      body {
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 50%,
          #0f0f23 100%
        );
        color: #fff;
        overflow-x: hidden;
        min-height: 100vh;
        position: relative;
        line-height: 1.6;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      }

      /* â•­â”€ COSMIC BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: radial-gradient(
            circle at 30% 20%,
            rgba(59, 130, 246, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 70% 80%,
            rgba(147, 51, 234, 0.025) 0%,
            transparent 50%
          );
        z-index: 0;
        animation: cosmicDrift 80s ease-in-out infinite;
      }

      @keyframes cosmicDrift {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        33% {
          transform: translate(-20px, -30px) scale(1.1);
        }
        66% {
          transform: translate(20px, -20px) scale(0.9);
        }
      }

      /* â•­â”€ FLOATING COSMIC ELEMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .cosmic-background {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 1;
      }

      .cosmic-orb {
        position: absolute;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.08) 0%,
          rgba(255, 255, 255, 0.02) 50%,
          transparent 80%
        );
        animation: orbitFloat 20s ease-in-out infinite;
        filter: blur(1px);
      }

      .cosmic-orb:nth-child(1) {
        width: clamp(40px, 10vw, 80px);
        height: clamp(40px, 10vw, 80px);
        top: 20%;
        left: 10%;
        animation-delay: 0s;
      }

      .cosmic-orb:nth-child(2) {
        width: clamp(60px, 15vw, 120px);
        height: clamp(60px, 15vw, 120px);
        top: 60%;
        right: 15%;
        animation-delay: 7s;
      }

      .cosmic-orb:nth-child(3) {
        width: clamp(30px, 8vw, 60px);
        height: clamp(30px, 8vw, 60px);
        bottom: 30%;
        left: 70%;
        animation-delay: 14s;
      }

      @keyframes orbitFloat {
        0%,
        100% {
          transform: translateY(0) scale(1);
          opacity: 0.4;
        }
        50% {
          transform: translateY(-30px) scale(1.1);
          opacity: 0.7;
        }
      }

      /* â•­â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .sacred-nav {
        position: sticky;
        top: 0;
        z-index: 100;
        background: rgba(15, 15, 35, 0.9);
        backdrop-filter: blur(30px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        padding: clamp(0.8rem, 2vw, 1rem) 0;
      }

      .nav-content {
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 clamp(1rem, 4vw, 2rem);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.6rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        font-weight: 400;
        transition: all 0.3s ease;
        min-height: 40px;
        white-space: nowrap;
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.95);
        transform: translateY(-1px);
      }

      .nav-center {
        flex: 1;
        display: flex;
        justify-content: center;
      }

      .reflection-nav {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 0.5rem 1rem;
      }

      .nav-arrow {
        background: transparent;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        cursor: pointer;
        padding: 0.3rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 1rem;
      }

      .nav-arrow:not(:disabled):hover {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.9);
      }

      .nav-arrow:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .nav-indicator {
        color: rgba(255, 255, 255, 0.8);
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        font-weight: 500;
      }

      .nav-separator {
        opacity: 0.5;
        margin: 0 0.5rem;
      }

      /* â•­â”€ MAIN CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .main-container {
        max-width: 800px;
        margin: 0 auto;
        padding: clamp(1rem, 4vw, 2rem);
        position: relative;
        z-index: 10;
        min-height: calc(100vh - 80px);
      }

      /* â•­â”€ LOADING STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .loading-section {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
      }

      .loading-content {
        text-align: center;
      }

      .sacred-loader {
        width: clamp(100px, 25vw, 140px);
        height: clamp(100px, 25vw, 140px);
        margin: 0 auto 2rem;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.12) 0%,
          rgba(255, 255, 255, 0.03) 60%,
          transparent 80%
        );
        position: relative;
        animation: sacredPulse 3s ease-in-out infinite;
      }

      .sacred-loader::after {
        content: "";
        position: absolute;
        inset: 25%;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.2) 0%,
          transparent 70%
        );
        animation: innerRotate 6s linear infinite;
      }

      @keyframes sacredPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.7;
        }
        50% {
          transform: scale(1.1);
          opacity: 1;
        }
      }

      @keyframes innerRotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: clamp(1rem, 3vw, 1.2rem);
        opacity: 0.8;
        font-weight: 300;
      }

      /* â•­â”€ ERROR STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .error-section {
        display: none;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
      }

      .error-section.is-visible {
        display: flex;
      }

      .error-content {
        text-align: center;
        max-width: 400px;
      }

      .error-icon {
        font-size: clamp(3rem, 8vw, 4rem);
        margin-bottom: 1.5rem;
        opacity: 0.6;
      }

      .error-title {
        font-size: clamp(1.4rem, 4vw, 1.8rem);
        font-weight: 300;
        margin-bottom: 1rem;
        color: rgba(255, 255, 255, 0.9);
      }

      .error-subtitle {
        font-size: clamp(0.9rem, 2.5vw, 1rem);
        opacity: 0.7;
        margin-bottom: 2rem;
        line-height: 1.6;
      }

      /* â•­â”€ REFLECTION ARTICLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .reflection-article {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 24px;
        overflow: hidden;
        margin-bottom: 2rem;
        display: none;
      }

      .reflection-article.is-visible {
        display: block;
        animation: articleAppear 1s ease-out;
      }

      @keyframes articleAppear {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      /* â•­â”€ REFLECTION HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .reflection-header {
        padding: clamp(2rem, 5vw, 3rem) clamp(1.5rem, 4vw, 2rem)
          clamp(1.5rem, 4vw, 2rem);
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .reflection-meta {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        gap: 1rem;
      }

      .meta-group {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .reflection-date {
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        opacity: 0.7;
        font-weight: 500;
      }

      .reflection-tone {
        padding: 0.4rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        font-size: clamp(0.7rem, 2vw, 0.8rem);
        text-transform: capitalize;
        font-weight: 600;
        letter-spacing: 0.3px;
      }

      .reflection-tone.fusion {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
      }

      .reflection-tone.gentle {
        background: rgba(255, 255, 255, 0.15);
        color: rgba(255, 255, 255, 0.9);
      }

      .reflection-tone.intense {
        background: rgba(147, 51, 234, 0.2);
        color: #a855f7;
      }

      .premium-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.4rem 1rem;
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
        border-radius: 16px;
        font-size: clamp(0.7rem, 2vw, 0.8rem);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
      }

      .reflection-title {
        font-size: clamp(1.8rem, 5vw, 2.5rem);
        font-weight: 300;
        margin: 0 0 1.5rem 0;
        line-height: 1.3;
        color: rgba(255, 255, 255, 0.95);
      }

      .reflection-stats {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: clamp(1rem, 3vw, 1.5rem);
        flex-wrap: wrap;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        opacity: 0.7;
      }

      .stat-icon {
        font-size: 0.9em;
      }

      /* â•­â”€ ARTIFACT PREVIEW SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .artifact-preview-section {
        padding: clamp(2rem, 5vw, 3rem) clamp(1.5rem, 4vw, 2rem);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        text-align: center;
      }

      .artifact-section-title {
        font-size: clamp(1.4rem, 4vw, 1.8rem);
        font-weight: 400;
        margin: 0 0 2rem 0;
        color: rgba(255, 255, 255, 0.95);
        position: relative;
      }

      .artifact-section-title::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
      }

      /* Artifact States */
      .artifact-create-state {
        padding: 2rem;
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.08) 0%,
          rgba(245, 158, 11, 0.04) 100%
        );
        backdrop-filter: blur(25px);
        border: 1px solid rgba(251, 191, 36, 0.2);
        border-radius: 20px;
        margin-bottom: 1rem;
      }

      .artifact-create-button {
        display: inline-flex;
        align-items: center;
        gap: 1rem;
        padding: 1.2rem 2rem;
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.15) 0%,
          rgba(245, 158, 11, 0.1) 100%
        );
        border: 2px solid rgba(251, 191, 36, 0.3);
        border-radius: 16px;
        color: rgba(251, 191, 36, 0.95);
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.4s ease;
        margin-bottom: 1rem;
      }

      .artifact-create-button:hover {
        background: linear-gradient(
          135deg,
          rgba(251, 191, 36, 0.25) 0%,
          rgba(245, 158, 11, 0.15) 100%
        );
        border-color: rgba(251, 191, 36, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(251, 191, 36, 0.25);
      }

      .artifact-create-description {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        line-height: 1.5;
      }

      .artifact-loading-state {
        display: none;
        padding: 2rem;
      }

      .artifact-loading-state.is-visible {
        display: block;
      }

      .artifact-loader {
        width: 80px;
        height: 80px;
        margin: 0 auto 1rem;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(251, 191, 36, 0.2) 0%,
          rgba(251, 191, 36, 0.05) 70%,
          transparent 100%
        );
        animation: artifactSpin 2s linear infinite;
        position: relative;
      }

      .artifact-loader::after {
        content: "";
        position: absolute;
        inset: 20%;
        border-radius: 50%;
        background: radial-gradient(
          circle,
          rgba(251, 191, 36, 0.4) 0%,
          transparent 70%
        );
        animation: artifactPulse 1.5s ease-in-out infinite;
      }

      @keyframes artifactSpin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes artifactPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.8;
        }
        50% {
          transform: scale(1.2);
          opacity: 1;
        }
      }

      .artifact-preview-state {
        display: none;
      }

      .artifact-preview-state.is-visible {
        display: block;
        animation: artifactReveal 1s ease-out;
      }

      @keyframes artifactReveal {
        from {
          opacity: 0;
          transform: scale(0.9) translateY(20px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }

      .artifact-image-container {
        margin-bottom: 1.5rem;
        position: relative;
      }

      .artifact-image {
        max-width: 100%;
        height: auto;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 2px solid rgba(251, 191, 36, 0.2);
      }

      .artifact-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .artifact-action-button {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        padding: 0.8rem 1.2rem;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 44px;
      }

      .artifact-action-button:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      .artifact-action-button.primary {
        background: linear-gradient(135deg, #10b981, #059669);
        border-color: transparent;
        color: white;
      }

      .artifact-action-button.primary:hover {
        background: linear-gradient(135deg, #059669, #047857);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
      }

      /* â•­â”€ QUESTIONS SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .questions-section {
        padding: clamp(2rem, 5vw, 3rem) clamp(1.5rem, 4vw, 2rem);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .section-title {
        font-size: clamp(1.4rem, 4vw, 1.8rem);
        font-weight: 400;
        margin: 0 0 2rem 0;
        text-align: center;
        color: rgba(255, 255, 255, 0.95);
      }

      .questions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: clamp(1rem, 3vw, 1.5rem);
      }

      .question-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        padding: clamp(1.2rem, 3vw, 1.5rem);
        transition: all 0.3s ease;
      }

      .question-card:hover {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(255, 255, 255, 0.12);
        transform: translateY(-2px);
      }

      .question-label {
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        opacity: 0.7;
        margin: 0 0 1rem 0;
      }

      .question-answer {
        font-size: clamp(0.9rem, 2.5vw, 1rem);
        line-height: 1.6;
        color: rgba(255, 255, 255, 0.9);
      }

      /* â•­â”€ MIRROR RESPONSE SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .response-section {
        padding: clamp(2rem, 5vw, 3rem) clamp(1.5rem, 4vw, 2rem);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .mirror-response {
        background: rgba(255, 255, 255, 0.97);
        color: #1a1a2e;
        border-radius: 20px;
        padding: clamp(2rem, 5vw, 3rem);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      }

      .mirror-response::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .response-content {
        font-size: clamp(1rem, 2.5vw, 1.1rem);
        line-height: 1.7;
        font-weight: 400;
        color: #2d3748;
      }

      .response-content p {
        margin: 0 0 1.5rem 0;
      }

      .response-content p:last-child {
        margin-bottom: 0;
      }

      .response-content strong {
        font-weight: 600;
        color: #1a202c;
      }

      .response-content em {
        font-style: italic;
        color: #4a5568;
      }

      /* â•­â”€ ACTIONS SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .actions-section {
        padding: clamp(1.5rem, 4vw, 2rem);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: clamp(0.8rem, 2vw, 1rem);
      }

      .action-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.6rem;
        padding: clamp(0.8rem, 2vw, 1rem) clamp(1rem, 3vw, 1.2rem);
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 16px;
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        font-size: clamp(0.8rem, 2vw, 0.9rem);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 48px;
      }

      .action-btn.primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: transparent;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .action-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-2px);
      }

      .action-btn.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .action-icon {
        font-size: 1em;
        flex-shrink: 0;
      }

      .action-text {
        white-space: nowrap;
      }

      /* â•­â”€ RELATED SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .related-section {
        padding: clamp(2rem, 5vw, 3rem) clamp(1.5rem, 4vw, 2rem);
      }

      .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: clamp(1rem, 3vw, 1.5rem);
      }

      .related-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: clamp(1.5rem, 4vw, 2rem);
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        text-decoration: none;
        color: rgba(255, 255, 255, 0.9);
        transition: all 0.4s ease;
      }

      .related-card:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 255, 255, 0.1);
      }

      .related-icon {
        font-size: clamp(1.5rem, 4vw, 2rem);
        flex-shrink: 0;
      }

      .related-title {
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        font-weight: 500;
        margin: 0 0 0.3rem 0;
      }

      .related-subtitle {
        font-size: clamp(0.7rem, 2vw, 0.8rem);
        opacity: 0.7;
        margin: 0;
        line-height: 1.4;
      }

      /* â•­â”€ TOAST NOTIFICATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .toast {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        z-index: 1000;
        background: rgba(16, 185, 129, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 16px;
        padding: 1rem 1.5rem;
        box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.4s ease;
        display: none;
      }

      .toast.show {
        transform: translateY(0);
        opacity: 1;
        display: block;
      }

      .toast-content {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        color: white;
        font-size: clamp(0.9rem, 2vw, 1rem);
        font-weight: 500;
      }

      .toast-icon {
        font-size: 1.2em;
      }

      /* â•­â”€ MOBILE RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      @media (max-width: 768px) {
        .nav-content {
          padding: 0 1rem;
          gap: 0.5rem;
        }

        .nav-link {
          padding: 0.5rem 0.8rem;
          font-size: 0.8rem;
        }

        .reflection-nav {
          padding: 0.4rem 0.8rem;
          gap: 0.8rem;
        }

        .reflection-meta {
          flex-direction: column;
          align-items: center;
          gap: 1rem;
        }

        .meta-group {
          justify-content: center;
        }

        .questions-grid {
          grid-template-columns: 1fr;
        }

        .actions-grid {
          grid-template-columns: 1fr;
          gap: 0.8rem;
        }

        .related-grid {
          grid-template-columns: 1fr;
        }

        .related-card {
          flex-direction: column;
          text-align: center;
          gap: 1rem;
        }

        .toast {
          bottom: 1rem;
          right: 1rem;
          left: 1rem;
        }

        .artifact-actions {
          flex-direction: column;
          align-items: center;
        }

        .artifact-action-button {
          width: 100%;
          max-width: 280px;
        }
      }

      @media (max-width: 480px) {
        .main-container {
          padding: 1rem 0.5rem;
        }

        .reflection-header {
          padding: 1.5rem 1rem 1rem;
        }

        .questions-section,
        .response-section {
          padding: 1.5rem 1rem;
        }

        .mirror-response {
          padding: 1.5rem;
        }

        .actions-section,
        .related-section {
          padding: 1.5rem 1rem;
        }

        .reflection-stats {
          flex-direction: column;
          gap: 0.8rem;
        }

        .nav-center {
          display: none;
        }

        .artifact-preview-section {
          padding: 1.5rem 1rem;
        }
      }

      /* â•­â”€ ACCESSIBILITY & MOTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      @media (prefers-contrast: high) {
        .reflection-article {
          border-color: rgba(255, 255, 255, 0.2);
        }

        .question-card {
          border-color: rgba(255, 255, 255, 0.15);
        }

        .action-btn {
          border-color: rgba(255, 255, 255, 0.25);
        }
      }

      /* â•­â”€ UTILITY CLASSES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•® */
      .hidden {
        display: none !important;
      }

      .loading {
        opacity: 0.6;
        pointer-events: none;
      }

      .fade-in {
        animation: fadeIn 0.8s ease forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <!-- Floating cosmic elements -->
    <div class="cosmic-background" id="cosmicBackground">
      <div class="cosmic-orb"></div>
      <div class="cosmic-orb"></div>
      <div class="cosmic-orb"></div>
    </div>

    <!-- Navigation -->
    <nav class="sacred-nav">
      <div class="nav-content">
        <a href="/reflections/history" class="nav-link back-link">
          <span>â†</span>
          <span>Your Journey</span>
        </a>

        <div class="nav-center">
          <div class="reflection-nav" id="reflectionNav">
            <button class="nav-arrow" id="prevReflection" disabled>
              <span>â†</span>
            </button>
            <div class="nav-indicator">
              <span id="currentPosition">1</span>
              <span class="nav-separator">of</span>
              <span id="totalReflections">1</span>
            </div>
            <button class="nav-arrow" id="nextReflection" disabled>
              <span>â†’</span>
            </button>
          </div>
        </div>

        <a href="/reflection" class="nav-link reflect-link">
          <span>âœ¨</span>
          <span>Reflect Again</span>
        </a>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
      <!-- Loading State -->
      <section class="loading-section" id="loadingSection">
        <div class="loading-content">
          <div class="sacred-loader"></div>
          <p class="loading-text">Preparing your reflection...</p>
        </div>
      </section>

      <!-- Error State -->
      <section class="error-section" id="errorSection">
        <div class="error-content">
          <div class="error-icon">ğŸŒ™</div>
          <h2 class="error-title">Reflection not found</h2>
          <p class="error-subtitle">
            This reflection may have been moved or removed
          </p>
          <a href="/reflections/history" class="action-btn primary">
            <span>â†</span>
            <span>Return to Your Journey</span>
          </a>
        </div>
      </section>

      <!-- Reflection Content -->
      <article class="reflection-article" id="reflectionArticle">
        <!-- Reflection Header -->
        <header class="reflection-header">
          <div class="reflection-meta">
            <div class="meta-group">
              <div class="reflection-date" id="reflectionDate">â€”</div>
              <div class="reflection-tone" id="reflectionTone">â€”</div>
            </div>
            <div class="premium-indicator hidden" id="premiumIndicator">
              <span class="premium-badge">âœ¨ Premium Reflection</span>
            </div>
          </div>

          <h1 class="reflection-title" id="reflectionTitle">
            Your Mirror of Truth
          </h1>

          <div class="reflection-stats">
            <span class="stat-item">
              <span class="stat-icon">ğŸ“</span>
              <span id="wordCount">â€” words</span>
            </span>
            <span class="stat-item">
              <span class="stat-icon">â±ï¸</span>
              <span id="readTime">â€” min read</span>
            </span>
            <span class="stat-item">
              <span class="stat-icon">ğŸ‘ï¸</span>
              <span id="viewCount">â€” views</span>
            </span>
          </div>
        </header>

        <!-- Artifact Preview Section -->
        <section class="artifact-preview-section">
          <h2 class="artifact-section-title">Your Sacred Artifact</h2>

          <!-- Artifact Creation State -->
          <div class="artifact-create-state" id="artifactCreateState">
            <button class="artifact-create-button" id="createArtifactButton">
              <span>ğŸ¨</span>
              <span>Create Your Artifact</span>
            </button>
            <div class="artifact-create-description">
              Transform your reflection into a personalized visual that captures
              your essence and insights
            </div>
          </div>

          <!-- Artifact Loading State -->
          <div class="artifact-loading-state" id="artifactLoadingState">
            <div class="artifact-loader"></div>
            <div style="color: rgba(251, 191, 36, 0.9); font-weight: 500">
              Creating your artifact...
            </div>
          </div>

          <!-- Artifact Preview State -->
          <div class="artifact-preview-state" id="artifactPreviewState">
            <div class="artifact-image-container">
              <img
                id="artifactImage"
                class="artifact-image"
                alt="Your Sacred Artifact"
              />
            </div>
            <div class="artifact-actions">
              <a
                id="downloadArtifactButton"
                class="artifact-action-button primary"
                download
              >
                <span>â¬‡ï¸</span>
                <span>Download</span>
              </a>
              <button id="shareArtifactButton" class="artifact-action-button">
                <span>ğŸ”—</span>
                <span>Share</span>
              </button>
              <button
                id="regenerateArtifactButton"
                class="artifact-action-button"
              >
                <span>ğŸ”„</span>
                <span>Regenerate</span>
              </button>
            </div>
          </div>
        </section>

        <!-- Original Questions -->
        <section class="questions-section" id="questionsSection">
          <h2 class="section-title">Your Sacred Questions</h2>
          <div class="questions-grid">
            <div class="question-card">
              <h3 class="question-label">Dream</h3>
              <div class="question-answer" id="dreamText">â€”</div>
            </div>
            <div class="question-card">
              <h3 class="question-label">Plan</h3>
              <div class="question-answer" id="planText">â€”</div>
            </div>
            <div class="question-card">
              <h3 class="question-label">Date Set</h3>
              <div class="question-answer" id="dateText">â€”</div>
            </div>
            <div class="question-card">
              <h3 class="question-label">Relationship</h3>
              <div class="question-answer" id="relationshipText">â€”</div>
            </div>
            <div class="question-card">
              <h3 class="question-label">Offering</h3>
              <div class="question-answer" id="offeringText">â€”</div>
            </div>
          </div>
        </section>

        <!-- Mirror's Response -->
        <section class="response-section">
          <h2 class="section-title">The Mirror's Truth</h2>
          <div class="mirror-response" id="mirrorResponse">
            <div class="response-content">
              <!-- Reflection content will be loaded here -->
            </div>
          </div>
        </section>

        <!-- Actions -->
        <section class="actions-section">
          <div class="actions-grid">
            <button class="action-btn secondary" id="emailBtn">
              <span class="action-icon">ğŸ“§</span>
              <span class="action-text">Email This Reflection</span>
            </button>

            <button class="action-btn secondary" id="shareBtn">
              <span class="action-icon">ğŸ”—</span>
              <span class="action-text">Copy Link</span>
            </button>

            <button class="action-btn secondary" id="downloadBtn">
              <span class="action-icon">ğŸ’¾</span>
              <span class="action-text">Save as PDF</span>
            </button>

            <a href="/reflection" class="action-btn primary">
              <span class="action-icon">âœ¨</span>
              <span class="action-text">Reflect Again</span>
            </a>
          </div>
        </section>

        <!-- Related Actions -->
        <section class="related-section">
          <h2 class="section-title">Continue Your Journey</h2>
          <div class="related-grid">
            <a href="/evolution" class="related-card">
              <div class="related-icon">ğŸ¦‹</div>
              <div class="related-content">
                <h3 class="related-title">Evolution Reports</h3>
                <p class="related-subtitle">See how you've grown over time</p>
              </div>
            </a>

            <a href="/reflections/history" class="related-card">
              <div class="related-icon">ğŸ“š</div>
              <div class="related-content">
                <h3 class="related-title">All Reflections</h3>
                <p class="related-subtitle">Browse your complete journey</p>
              </div>
            </a>

            <a href="/reflection" class="related-card">
              <div class="related-icon">ğŸª</div>
              <div class="related-content">
                <h3 class="related-title">New Reflection</h3>
                <p class="related-subtitle">Add to your journey today</p>
              </div>
            </a>
          </div>
        </section>
      </article>
    </main>

    <!-- Success Messages -->
    <div class="toast" id="successToast">
      <div class="toast-content">
        <span class="toast-icon">âœ…</span>
        <span class="toast-message">â€”</span>
      </div>
    </div>

    <script>
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REFLECTION VIEW - COMPLETE SCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

      "use strict";

      let authToken = null;
      let currentUser = null;
      let currentReflection = null;
      let allReflectionIds = [];
      let currentIndex = -1;
      let reflectionId = null;
      let artifactData = null;

      /* â•â•â• INITIALIZATION â•â•â• */
      window.addEventListener("load", async () => {
        await checkAuthentication();
        extractReflectionId();
        await loadReflection();
        setupEventListeners();
        animateEntrance();
      });

      /* â•â•â• AUTHENTICATION â•â•â• */
      async function checkAuthentication() {
        authToken = localStorage.getItem("mirror_auth_token");

        if (!authToken) {
          window.location.href =
            "/auth/signin?redirect=" +
            encodeURIComponent(
              window.location.pathname + window.location.search
            );
          return;
        }

        try {
          const response = await fetch("/api/auth", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({ action: "verify-token" }),
          });

          const data = await response.json();

          if (!response.ok || !data.success) {
            localStorage.removeItem("mirror_auth_token");
            window.location.href = "/auth/signin";
            return;
          }

          currentUser = data.user;
          console.log("ğŸª Authenticated user:", currentUser.email);
        } catch (error) {
          console.error("Auth verification failed:", error);
          localStorage.removeItem("mirror_auth_token");
          window.location.href = "/auth/signin";
        }
      }

      /* â•â•â• REFLECTION LOADING â•â•â• */
      function extractReflectionId() {
        const urlParams = new URLSearchParams(window.location.search);
        reflectionId = urlParams.get("id");

        if (!reflectionId) {
          showError("No reflection ID provided");
          return;
        }
      }

      async function loadReflection() {
        if (!reflectionId) return;

        setLoading(true);

        try {
          const response = await fetch("/api/reflections", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              action: "get-reflection",
              id: reflectionId,
            }),
          });

          const data = await response.json();

          if (!response.ok || !data.success) {
            throw new Error(data.error || "Failed to load reflection");
          }

          currentReflection = data.reflection;
          await loadReflectionNavigation();
          displayReflection();
          await checkExistingArtifact();
        } catch (error) {
          console.error("Failed to load reflection:", error);
          showError(
            "Unable to load this reflection. It may have been removed or you may not have permission to view it."
          );
        } finally {
          setLoading(false);
        }
      }

      async function loadReflectionNavigation() {
        try {
          const response = await fetch("/api/reflections", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              action: "get-history",
              page: 1,
              limit: 1000,
              sortBy: "created_at",
              sortOrder: "desc",
            }),
          });

          const data = await response.json();

          if (response.ok && data.success) {
            allReflectionIds = data.reflections.map((r) => r.id);
            currentIndex = allReflectionIds.indexOf(reflectionId);
            updateNavigationUI();
          }
        } catch (error) {
          console.error("Failed to load navigation data:", error);
        }
      }

      async function checkExistingArtifact() {
        try {
          // Check if artifact exists for this reflection
          const response = await fetch(`/api/artifact/check/${reflectionId}`, {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
          });

          if (response.ok) {
            const data = await response.json();
            if (data.success && data.artifact) {
              artifactData = data.artifact;
              showArtifactPreview(data.artifact);
            }
          }
        } catch (error) {
          console.log("No existing artifact found");
        }
      }

      /* â•â•â• DISPLAY REFLECTION â•â•â• */
      function displayReflection() {
        if (!currentReflection) return;

        document.title = `${
          currentReflection.title || "Reflection"
        } | Mirror of Truth`;

        document.getElementById("reflectionDate").textContent =
          formatReflectionDate(currentReflection.created_at);
        document.getElementById("reflectionTone").textContent =
          currentReflection.tone;
        document.getElementById(
          "reflectionTone"
        ).className = `reflection-tone ${currentReflection.tone}`;

        if (currentReflection.is_premium) {
          document
            .getElementById("premiumIndicator")
            .classList.remove("hidden");
        }

        document.getElementById("reflectionTitle").textContent =
          currentReflection.title || "Your Mirror of Truth";

        document.getElementById("wordCount").textContent = `${
          currentReflection.word_count || 0
        } words`;
        document.getElementById("readTime").textContent = `${
          currentReflection.estimated_read_time || 1
        } min read`;
        document.getElementById("viewCount").textContent = `${
          currentReflection.view_count || 0
        } views`;

        document.getElementById("dreamText").textContent =
          currentReflection.dream || "â€”";
        document.getElementById("planText").textContent =
          currentReflection.plan || "â€”";

        let dateText = currentReflection.has_date || "No";
        if (
          currentReflection.has_date === "yes" &&
          currentReflection.dream_date
        ) {
          const dreamDate = new Date(currentReflection.dream_date);
          dateText = `Yes - ${dreamDate.toLocaleDateString()}`;
        }
        document.getElementById("dateText").textContent = dateText;

        document.getElementById("relationshipText").textContent =
          currentReflection.relationship || "â€”";
        document.getElementById("offeringText").textContent =
          currentReflection.offering || "â€”";

        const responseElement = document.querySelector(
          "#mirrorResponse .response-content"
        );
        if (currentReflection.ai_response) {
          responseElement.innerHTML = currentReflection.ai_response;
        } else {
          responseElement.textContent = "No reflection content available.";
        }

        showReflection();
      }

      function updateNavigationUI() {
        const prevBtn = document.getElementById("prevReflection");
        const nextBtn = document.getElementById("nextReflection");
        const currentPos = document.getElementById("currentPosition");
        const totalReflections = document.getElementById("totalReflections");

        if (allReflectionIds.length > 0 && currentIndex >= 0) {
          currentPos.textContent = currentIndex + 1;
          totalReflections.textContent = allReflectionIds.length;

          prevBtn.disabled = currentIndex === 0;
          nextBtn.disabled = currentIndex === allReflectionIds.length - 1;
        } else {
          document.getElementById("reflectionNav").style.display = "none";
        }
      }

      /* â•â•â• ARTIFACT MANAGEMENT â•â•â• */
      async function createArtifact() {
        if (!reflectionId) {
          alert("No reflection found to create artifact from.");
          return;
        }

        console.log("ğŸ¨ Creating artifact...");

        showArtifactLoading();

        try {
          const response = await fetch("/api/artifact", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${authToken}`,
            },
            body: JSON.stringify({
              reflectionId: reflectionId,
            }),
          });

          const data = await response.json();

          if (data.success && data.artifact) {
            console.log("âœ¨ Artifact created successfully!");
            artifactData = data.artifact;
            showArtifactPreview(data.artifact);
          } else {
            throw new Error(data.error || "Artifact creation failed");
          }
        } catch (error) {
          console.error("ğŸ’¥ Artifact creation failed:", error);
          showToast("âŒ Failed to create artifact. Please try again.");
          showArtifactCreate();
        }
      }

      function showArtifactCreate() {
        document.getElementById("artifactCreateState").style.display = "block";
        document
          .getElementById("artifactLoadingState")
          .classList.remove("is-visible");
        document
          .getElementById("artifactPreviewState")
          .classList.remove("is-visible");
      }

      function showArtifactLoading() {
        document.getElementById("artifactCreateState").style.display = "none";
        document
          .getElementById("artifactLoadingState")
          .classList.add("is-visible");
        document
          .getElementById("artifactPreviewState")
          .classList.remove("is-visible");
      }

      function showArtifactPreview(artifact) {
        document.getElementById("artifactCreateState").style.display = "none";
        document
          .getElementById("artifactLoadingState")
          .classList.remove("is-visible");

        const artifactImage = document.getElementById("artifactImage");
        const downloadButton = document.getElementById(
          "downloadArtifactButton"
        );

        artifactImage.src = artifact.image_url;
        artifactImage.alt = "Your Sacred Artifact";

        downloadButton.href = artifact.image_url;
        downloadButton.download = `mirror-artifact-${Date.now()}.png`;

        document
          .getElementById("artifactPreviewState")
          .classList.add("is-visible");
      }

      function shareArtifact() {
        if (!artifactData?.image_url) return;

        const url = artifactData.image_url;

        if (navigator.share) {
          navigator
            .share({
              title: "My Mirror of Truth Artifact",
              text: "Check out my personalized reflection artifact",
              url: url,
            })
            .catch((err) => {
              console.log("Share failed:", err);
              copyToClipboard(url);
            });
        } else {
          copyToClipboard(url);
        }
      }

      async function regenerateArtifact() {
        if (
          !confirm(
            "Are you sure you want to create a new artifact? This will replace your current one."
          )
        ) {
          return;
        }

        artifactData = null;
        showArtifactCreate();
        await createArtifact();
      }

      /* â•â•â• EVENT LISTENERS â•â•â• */
      function setupEventListeners() {
        document
          .getElementById("prevReflection")
          .addEventListener("click", () => navigateReflection("prev"));
        document
          .getElementById("nextReflection")
          .addEventListener("click", () => navigateReflection("next"));

        document
          .getElementById("createArtifactButton")
          .addEventListener("click", createArtifact);
        document
          .getElementById("shareArtifactButton")
          .addEventListener("click", shareArtifact);
        document
          .getElementById("regenerateArtifactButton")
          .addEventListener("click", regenerateArtifact);

        document
          .getElementById("emailBtn")
          .addEventListener("click", emailReflection);
        document
          .getElementById("shareBtn")
          .addEventListener("click", shareReflection);
        document
          .getElementById("downloadBtn")
          .addEventListener("click", downloadReflection);

        document.addEventListener("keydown", handleKeyboardShortcuts);
      }

      function handleKeyboardShortcuts(e) {
        if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")
          return;

        switch (e.key) {
          case "ArrowLeft":
            e.preventDefault();
            navigateReflection("prev");
            break;
          case "ArrowRight":
            e.preventDefault();
            navigateReflection("next");
            break;
          case "e":
            e.preventDefault();
            emailReflection();
            break;
          case "s":
            if (e.ctrlKey || e.metaKey) {
              e.preventDefault();
              downloadReflection();
            } else {
              e.preventDefault();
              shareReflection();
            }
            break;
          case "r":
            if (!e.ctrlKey && !e.metaKey) {
              e.preventDefault();
              window.location.href = "/reflection";
            }
            break;
          case "h":
            e.preventDefault();
            window.location.href = "/reflections/history";
            break;
        }
      }

      /* â•â•â• NAVIGATION â•â•â• */
      function navigateReflection(direction) {
        if (allReflectionIds.length === 0 || currentIndex < 0) return;

        let newIndex;
        if (direction === "prev") {
          newIndex = currentIndex - 1;
        } else {
          newIndex = currentIndex + 1;
        }

        if (newIndex < 0 || newIndex >= allReflectionIds.length) return;

        const newReflectionId = allReflectionIds[newIndex];
        const url = new URL(window.location);
        url.searchParams.set("id", newReflectionId);
        window.history.pushState({}, "", url);

        reflectionId = newReflectionId;
        currentIndex = newIndex;

        loadReflection();
      }

      /* â•â•â• ACTIONS â•â•â• */
      async function emailReflection() {
        const btn = document.getElementById("emailBtn");
        const originalContent = btn.innerHTML;

        btn.innerHTML =
          '<span class="action-icon">ğŸ“§</span><span class="action-text">Sending...</span>';
        btn.disabled = true;

        try {
          const response = await fetch("/api/communication", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              action: "send-reflection",
              email: currentUser.email,
              content: currentReflection.ai_response,
              userName: currentUser.name || "Friend",
              language: currentUser.language || "en",
              isPremium: currentReflection.is_premium,
            }),
          });

          const data = await response.json();

          if (data.success) {
            showToast("âœ… Reflection sent to your email");
            btn.innerHTML =
              '<span class="action-icon">âœ…</span><span class="action-text">Sent!</span>';
          } else {
            throw new Error(data.error || "Failed to send email");
          }
        } catch (error) {
          console.error("Email failed:", error);
          showToast("âŒ Failed to send email. Please try again.");
          btn.innerHTML =
            '<span class="action-icon">âš¡</span><span class="action-text">Try Again</span>';
        }

        setTimeout(() => {
          btn.innerHTML = originalContent;
          btn.disabled = false;
        }, 3000);
      }

      function shareReflection() {
        const url = window.location.href;

        if (navigator.share) {
          navigator
            .share({
              title: currentReflection.title || "My Mirror of Truth Reflection",
              text: "Check out my reflection from The Mirror of Truth",
              url: url,
            })
            .catch((err) => {
              console.log("Share failed:", err);
              copyToClipboard(url);
            });
        } else {
          copyToClipboard(url);
        }
      }

      function copyToClipboard(text) {
        if (navigator.clipboard) {
          navigator.clipboard
            .writeText(text)
            .then(() => {
              showToast("ğŸ”— Link copied to clipboard");
            })
            .catch(() => {
              fallbackCopyToClipboard(text);
            });
        } else {
          fallbackCopyToClipboard(text);
        }
      }

      function fallbackCopyToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        textArea.style.top = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
          document.execCommand("copy");
          showToast("ğŸ”— Link copied to clipboard");
        } catch (err) {
          showToast("âŒ Unable to copy link");
        }

        document.body.removeChild(textArea);
      }

      function downloadReflection() {
        try {
          const content = `
${currentReflection.title || "Mirror of Truth Reflection"}
${new Date(currentReflection.created_at).toLocaleDateString()}
Tone: ${currentReflection.tone}
${currentReflection.is_premium ? "Premium Reflection" : ""}

DREAM:
${currentReflection.dream}

PLAN:
${currentReflection.plan}

DATE SET:
${
  currentReflection.has_date === "yes"
    ? currentReflection.dream_date
      ? new Date(currentReflection.dream_date).toLocaleDateString()
      : "Yes"
    : "No"
}

RELATIONSHIP WITH DREAM:
${currentReflection.relationship}

OFFERING:
${currentReflection.offering}

MIRROR'S REFLECTION:
${stripHtml(currentReflection.ai_response)}

---
Generated by The Mirror of Truth
${window.location.origin}
          `.trim();

          const blob = new Blob([content], { type: "text/plain" });
          const url = URL.createObjectURL(blob);

          const a = document.createElement("a");
          a.href = url;
          a.download = `mirror-reflection-${
            new Date(currentReflection.created_at).toISOString().split("T")[0]
          }.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          showToast("ğŸ’¾ Reflection downloaded");
        } catch (error) {
          console.error("Download failed:", error);
          showToast("âŒ Download failed. Please try again.");
        }
      }

      /* â•â•â• UI STATES â•â•â• */
      function setLoading(loading) {
        const loadingSection = document.getElementById("loadingSection");
        const reflectionArticle = document.getElementById("reflectionArticle");
        const errorSection = document.getElementById("errorSection");

        if (loading) {
          loadingSection.style.display = "flex";
          reflectionArticle.classList.remove("is-visible");
          errorSection.classList.remove("is-visible");
        } else {
          loadingSection.style.display = "none";
        }
      }

      function showReflection() {
        const reflectionArticle = document.getElementById("reflectionArticle");
        const errorSection = document.getElementById("errorSection");

        reflectionArticle.classList.add("is-visible");
        errorSection.classList.remove("is-visible");
      }

      function showError(message) {
        const loadingSection = document.getElementById("loadingSection");
        const reflectionArticle = document.getElementById("reflectionArticle");
        const errorSection = document.getElementById("errorSection");

        loadingSection.style.display = "none";
        reflectionArticle.classList.remove("is-visible");
        errorSection.classList.add("is-visible");

        const errorSubtitle = errorSection.querySelector(".error-subtitle");
        if (errorSubtitle && message) {
          errorSubtitle.textContent = message;
        }
      }

      function showToast(message) {
        const toast = document.getElementById("successToast");
        const toastMessage = toast.querySelector(".toast-message");

        toastMessage.textContent = message;
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      /* â•â•â• ANIMATIONS â•â•â• */
      function animateEntrance() {
        const cosmicElements = document.querySelectorAll(".cosmic-orb");

        cosmicElements.forEach((element, index) => {
          element.style.opacity = "0";
          element.style.transform = "scale(0.5)";

          setTimeout(() => {
            element.style.transition = "all 1s ease";
            element.style.opacity = "";
            element.style.transform = "";
          }, index * 200);
        });
      }

      /* â•â•â• UTILITY FUNCTIONS â•â•â• */
      function formatReflectionDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffDays === 0) return "Today";
        if (diffDays === 1) return "Yesterday";
        if (diffDays < 7) return `${diffDays} days ago`;
        if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
        if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;

        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function stripHtml(html) {
        const div = document.createElement("div");
        div.innerHTML = html;
        return div.textContent || div.innerText || "";
      }

      /* â•â•â• RESPONSIVE HANDLING â•â•â• */
      function handleResize() {
        const isMobile = window.innerWidth <= 768;
        const navCenter = document.querySelector(".nav-center");
        if (window.innerWidth <= 480) {
          navCenter.style.display = "none";
        } else {
          navCenter.style.display = "flex";
        }
      }

      window.addEventListener("resize", debounce(handleResize, 250));

      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      handleResize();
    </script>
  </body>
</html>
